<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Settings - SMon</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    /* Custom slider styling */
    .slider::-webkit-slider-thumb {
      appearance: none;
      height: 20px;
      width: 20px;
      border-radius: 50%;
      background: linear-gradient(135deg, #3b82f6, #1d4ed8);
      cursor: pointer;
      border: 2px solid #1e293b;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      transition: all 0.2s ease;
    }
    .slider::-webkit-slider-thumb:hover {
      transform: scale(1.1);
      box-shadow: 0 4px 8px rgba(59, 130, 246, 0.3);
    }
    .slider::-moz-range-thumb {
      height: 20px;
      width: 20px;
      border-radius: 50%;
      background: linear-gradient(135deg, #3b82f6, #1d4ed8);
      cursor: pointer;
      border: 2px solid #1e293b;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      transition: all 0.2s ease;
    }
    .slider::-moz-range-thumb:hover {
      transform: scale(1.1);
      box-shadow: 0 4px 8px rgba(59, 130, 246, 0.3);
    }
    .slider::-webkit-slider-track {
      background: linear-gradient(90deg, #374151 0%, #4b5563 100%);
      height: 8px;
      border-radius: 4px;
      border: 1px solid #6b7280;
    }
    .slider::-moz-range-track {
      background: linear-gradient(90deg, #374151 0%, #4b5563 100%);
      height: 8px;
      border-radius: 4px;
      border: 1px solid #6b7280;
    }

    /* Status animations */
    @keyframes pulse-green {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    .animate-pulse-green {
      animation: pulse-green 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }

    /* Smooth transitions for all interactive elements */
    * {
      transition-property: color, background-color, border-color, text-decoration-color, fill, stroke, opacity, box-shadow, transform, filter, backdrop-filter;
      transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
      transition-duration: 300ms;
    }
  </style>
</head>
<body class="bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 text-gray-100 min-h-screen">
  <div class="flex h-screen">
    <!-- Mobile Menu Button -->
    <button id="mobile-menu-button" class="md:hidden fixed top-4 left-4 z-50 bg-gradient-to-br from-slate-800 to-slate-900 p-3 rounded-xl border border-slate-700/50 shadow-xl hover:shadow-2xl hover:border-slate-600/70 transition-all duration-300 group">
      <i class="fas fa-bars text-white group-hover:scale-110 transition-transform duration-200"></i>
    </button>

    <!-- Mobile Overlay -->
    <div id="mobile-overlay" class="md:hidden fixed inset-0 bg-black bg-opacity-60 backdrop-blur-sm z-30 hidden"></div>

    <!-- Sidebar -->
    <div id="sidebar" class="w-64 bg-gradient-to-b from-slate-950 to-slate-900 border-r border-slate-700/50 shadow-2xl flex flex-col fixed md:relative inset-y-0 left-0 z-40 transform -translate-x-full md:translate-x-0 transition-all duration-300 ease-in-out">
      <!-- Header -->
      <div class="p-6 border-b border-slate-700/50 bg-gradient-to-r from-slate-900/50 to-slate-800/50">
        <div class="flex items-center gap-3 mb-1">
          <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl flex items-center justify-center shadow-lg hover:shadow-xl transition-all duration-300 group">
            <i class="fas fa-chart-line text-white font-bold text-lg group-hover:scale-110 transition-transform duration-200"></i>
          </div>
          <div>
            <h1 class="text-lg font-bold text-white">SMon</h1>
            <p class="text-xs text-gray-400">SNMP Monitor</p>
          </div>
        </div>
      </div>

      <!-- Navigation -->
      <nav class="flex-1 px-4 py-6 overflow-y-auto">
        <div class="space-y-2">
          <a href="/" class="flex items-center gap-3 px-4 py-3 rounded-xl text-gray-300 hover:bg-gradient-to-r hover:from-slate-700 hover:to-slate-800 hover:text-white transition-all duration-300 hover:shadow-lg hover:scale-[1.02] group">
            <i class="fas fa-chart-area w-5 group-hover:scale-110 transition-transform duration-200"></i>
            <span>Dashboard</span>
          </a>
          <a href="/monitoring" class="flex items-center gap-3 px-4 py-3 rounded-xl text-gray-300 hover:bg-gradient-to-r hover:from-slate-700 hover:to-slate-800 hover:text-white transition-all duration-300 hover:shadow-lg hover:scale-[1.02] group">
            <i class="fas fa-gauge-high w-5 group-hover:scale-110 transition-transform duration-200"></i>
            <span>Bandwidth Monitor</span>
          </a>
          <a href="/ping" class="flex items-center gap-3 px-4 py-3 rounded-xl text-gray-300 hover:bg-gradient-to-r hover:from-slate-700 hover:to-slate-800 hover:text-white transition-all duration-300 hover:shadow-lg hover:scale-[1.02] group">
            <i class="fas fa-network-wired w-5 group-hover:scale-110 transition-transform duration-200"></i>
            <span>Ping Monitor</span>
          <a href="/websites" class="flex items-center gap-3 px-4 py-3 rounded-lg text-gray-300 hover:bg-slate-700 transition-all duration-200">
            <i class="fas fa-globe w-5"></i>
            <span>Website Monitor</span>
          </a>
          </a>
          <a href="/devices" class="flex items-center gap-3 px-4 py-3 rounded-xl text-gray-300 hover:bg-gradient-to-r hover:from-slate-700 hover:to-slate-800 hover:text-white transition-all duration-300 hover:shadow-lg hover:scale-[1.02] group">
            <i class="fas fa-server w-5 group-hover:scale-110 transition-transform duration-200"></i>
            <span>Devices</span>
          </a>
          <a href="/history" class="flex items-center gap-3 px-4 py-3 rounded-xl text-gray-300 hover:bg-gradient-to-r hover:from-slate-700 hover:to-slate-800 hover:text-white transition-all duration-300 hover:shadow-lg hover:scale-[1.02] group">
            <i class="fas fa-history w-5 group-hover:scale-110 transition-transform duration-200"></i>
            <span>History</span>
          </a>
          <a href="/settings" class="flex items-center gap-3 px-4 py-3 rounded-xl bg-gradient-to-r from-blue-600 to-blue-700 text-white font-medium transition-all hover:shadow-lg hover:shadow-blue-500/25 hover:scale-[1.02] group">
            <i class="fas fa-cog w-5 group-hover:scale-110 transition-transform duration-200"></i>
            <span>Settings</span>
          </a>
          <a href="/about" class="flex items-center gap-3 px-4 py-3 rounded-xl text-gray-300 hover:bg-gradient-to-r hover:from-slate-700 hover:to-slate-800 hover:text-white transition-all duration-300 hover:shadow-lg hover:scale-[1.02] group">
            <i class="fas fa-info-circle w-5 group-hover:scale-110 transition-transform duration-200"></i>
            <span>About</span>
          </a>
          <a href="/logout" class="flex items-center gap-3 px-4 py-3 rounded-xl text-red-400 hover:bg-gradient-to-r hover:from-red-500/20 hover:to-red-600/20 hover:text-red-300 transition-all duration-300 hover:shadow-lg hover:scale-[1.02] mt-4 group">
            <i class="fas fa-sign-out-alt w-5 group-hover:scale-110 transition-transform duration-200"></i>
            <span>Logout</span>
          </a>
        </div>
      </nav>

      <!-- Footer -->
      <div class="px-4 py-4 border-t border-slate-700/50 bg-gradient-to-r from-slate-900/30 to-slate-800/30">
        <div class="text-xs text-gray-500 text-center">
          <p class="font-medium">SNMP Monitor v2.0</p>
          <p class="text-gray-600">Network Intelligence</p>
        </div>
      </div>
    </div>

    <!-- Main Content -->
    <div class="flex-1 overflow-auto md:ml-0">
      <!-- Top Header -->
      <div class="bg-gradient-to-r from-slate-950 to-slate-900 border-b border-slate-700/50 px-4 md:px-8 py-4 sticky top-0 z-20 shadow-xl">
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
          <div>
            <h2 class="text-2xl font-bold text-white flex items-center gap-3">
              <div class="w-8 h-8 bg-gradient-to-br from-orange-500 to-orange-600 rounded-lg flex items-center justify-center shadow-lg">
                <i class="fas fa-cog text-white text-sm"></i>
              </div>
              Settings
            </h2>
            <p class="text-gray-400 text-sm mt-1">Configure system parameters and monitoring options</p>
          </div>

          <!-- System Stats -->
          <div class="flex flex-wrap gap-3 text-xs">
            <div class="flex items-center gap-2 bg-gradient-to-br from-slate-800 to-slate-900 px-3 py-2 rounded-xl border border-slate-700/50 hover:border-blue-500/40 hover:shadow-lg hover:shadow-blue-500/20 transition-all duration-300 hover:scale-105 group">
              <div class="w-6 h-6 bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg flex items-center justify-center shadow-md group-hover:shadow-lg group-hover:scale-110 transition-all duration-200">
                <i class="fas fa-microchip text-white text-xs"></i>
              </div>
              <div>
                <p class="text-gray-400 font-medium">CPU</p>
                <p class="text-white font-semibold" id="header-cpu">--%</p>
              </div>
            </div>
            <div class="flex items-center gap-2 bg-gradient-to-br from-slate-800 to-slate-900 px-3 py-2 rounded-xl border border-slate-700/50 hover:border-green-500/40 hover:shadow-lg hover:shadow-green-500/20 transition-all duration-300 hover:scale-105 group">
              <div class="w-6 h-6 bg-gradient-to-br from-green-500 to-green-600 rounded-lg flex items-center justify-center shadow-md group-hover:shadow-lg group-hover:scale-110 transition-all duration-200">
                <i class="fas fa-memory text-white text-xs"></i>
              </div>
              <div>
                <p class="text-gray-400 font-medium">Memory</p>
                <p class="text-white font-semibold" id="header-memory">--</p>
              </div>
            </div>
            <div class="flex items-center gap-2 bg-gradient-to-br from-slate-800 to-slate-900 px-3 py-2 rounded-xl border border-slate-700/50 hover:border-purple-500/40 hover:shadow-lg hover:shadow-purple-500/20 transition-all duration-300 hover:scale-105 group">
              <div class="w-6 h-6 bg-gradient-to-br from-purple-500 to-purple-600 rounded-lg flex items-center justify-center shadow-md group-hover:shadow-lg group-hover:scale-110 transition-all duration-200">
                <i class="fas fa-database text-white text-xs"></i>
              </div>
              <div>
                <p class="text-gray-400 font-medium">Database</p>
                <p class="text-green-400 font-semibold" id="header-db"><i class="fas fa-circle text-xs"></i> Online</p>
              </div>
            </div>
            <div class="flex items-center gap-2 bg-gradient-to-br from-slate-800 to-slate-900 px-3 py-2 rounded-xl border border-slate-700/50 hover:border-orange-500/40 hover:shadow-lg hover:shadow-orange-500/20 transition-all duration-300 hover:scale-105 group">
              <div class="w-6 h-6 bg-gradient-to-br from-orange-500 to-orange-600 rounded-lg flex items-center justify-center shadow-md group-hover:shadow-lg group-hover:scale-110 transition-all duration-200">
                <i class="fas fa-hdd text-white text-xs"></i>
              </div>
              <div>
                <p class="text-gray-400 font-medium">Storage</p>
                <p class="text-white font-semibold" id="header-storage">--</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Content -->
      <div class="flex-1 overflow-y-auto">
        <!-- Header -->
        <div class="bg-gradient-to-r from-slate-900 via-slate-800 to-slate-900 border-b border-slate-700/50 p-6">
          <div class="flex items-center justify-between">
            <div>
              <h1 class="text-2xl font-bold text-white flex items-center gap-3">
                <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl flex items-center justify-center shadow-lg">
                  <i class="fas fa-cog text-white"></i>
                </div>
                Settings
              </h1>
              <p class="text-gray-400 mt-1">Configure your SNMP monitoring system</p>
            </div>
            <div class="flex items-center gap-4">
              <div class="hidden md:flex items-center gap-2 bg-slate-800/50 px-4 py-2 rounded-xl border border-slate-700/50">
                <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                <span class="text-sm text-gray-300">System Online</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Main Content -->
        <div class="p-6 space-y-8">
          <!-- System Configuration Section -->
          <div class="space-y-6">
            <div class="flex items-center gap-3">
              <div class="w-8 h-8 bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg flex items-center justify-center shadow-lg">
                <i class="fas fa-server text-white text-sm"></i>
              </div>
              <h2 class="text-xl font-bold text-white">System Configuration</h2>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
              <!-- InfluxDB Configuration -->
              <div class="bg-gradient-to-br from-slate-800 to-slate-900 rounded-xl border border-slate-700/50 p-6 shadow-xl hover:shadow-2xl transition-all duration-300 group">
                <div class="flex items-start justify-between mb-6">
                  <div>
                    <h3 class="text-lg font-bold text-white flex items-center gap-2">
                      <div class="w-8 h-8 bg-gradient-to-br from-purple-500 to-purple-600 rounded-lg flex items-center justify-center shadow-lg group-hover:scale-110 transition-transform duration-200">
                        <i class="fas fa-database text-white text-sm"></i>
                      </div>
                      InfluxDB Database
                    </h3>
                    <p class="text-sm text-gray-400 mt-1">Time-series database connection settings</p>
                  </div>
                  <div class="flex items-center gap-2">
                    <div class="w-3 h-3 bg-green-500 rounded-full animate-pulse"></div>
                    <span class="text-xs text-gray-400">Connected</span>
                  </div>
                </div>

                <div class="space-y-4">
                  <!-- URL -->
                  <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2 flex items-center gap-2">
                      <i class="fas fa-link text-purple-400 text-xs"></i>
                      Server URL
                    </label>
                    <input type="text"
                           id="influxdb-url"
                           value="<%= settings.influxdb?.url || '' %>"
                           placeholder="http://localhost:8086"
                           class="w-full bg-gradient-to-br from-slate-700 to-slate-800 border border-slate-600/50 rounded-xl px-4 py-3 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-all duration-200 hover:border-slate-500/70">
                    <p class="text-xs text-gray-500 mt-1">InfluxDB server endpoint</p>
                  </div>

                  <!-- Organization -->
                  <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2 flex items-center gap-2">
                      <i class="fas fa-building text-purple-400 text-xs"></i>
                      Organization
                    </label>
                    <input type="text"
                           id="influxdb-org"
                           value="<%= settings.influxdb?.org || '' %>"
                           placeholder="indobsd"
                           class="w-full bg-gradient-to-br from-slate-700 to-slate-800 border border-slate-600/50 rounded-xl px-4 py-3 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-all duration-200 hover:border-slate-500/70">
                    <p class="text-xs text-gray-500 mt-1">InfluxDB organization name</p>
                  </div>

                  <!-- Bucket -->
                  <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2 flex items-center gap-2">
                      <i class="fas fa-archive text-purple-400 text-xs"></i>
                      Bucket
                    </label>
                    <input type="text"
                           id="influxdb-bucket"
                           value="<%= settings.influxdb?.bucket || '' %>"
                           placeholder="graphts"
                           class="w-full bg-gradient-to-br from-slate-700 to-slate-800 border border-slate-600/50 rounded-xl px-4 py-3 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-all duration-200 hover:border-slate-500/70">
                    <p class="text-xs text-gray-500 mt-1">Data bucket name</p>
                  </div>

                  <!-- API Token -->
                  <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2 flex items-center gap-2">
                      <i class="fas fa-key text-purple-400 text-xs"></i>
                      API Token
                    </label>
                    <div class="relative">
                      <input type="password"
                             id="influxdb-token"
                             value="<%= settings.influxdb?.token || '' %>"
                             placeholder="Enter your InfluxDB API token"
                             class="w-full bg-gradient-to-br from-slate-700 to-slate-800 border border-slate-600/50 rounded-xl px-4 py-3 pr-10 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-all duration-200 hover:border-slate-500/70">
                      <button type="button" id="toggle-token-visibility" class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-white p-2 rounded-lg hover:bg-slate-700/50 transition-all duration-200 hover:scale-110">
                        <i class="fas fa-eye" id="token-eye-icon"></i>
                      </button>
                    </div>
                    <p class="text-xs text-gray-500 mt-1">API token with read/write permissions</p>
                  </div>

                  <!-- Action Buttons -->
                  <div class="flex gap-3 pt-2">
                    <button id="test-influxdb-btn" class="flex-1 px-4 py-3 bg-gradient-to-r from-purple-600 to-purple-700 hover:from-purple-700 hover:to-purple-800 text-white rounded-xl transition-all duration-300 font-medium text-sm hover:shadow-lg hover:shadow-purple-500/25 hover:scale-105 flex items-center justify-center gap-2">
                      <i class="fas fa-plug"></i>
                      <span>Test Connection</span>
                    </button>
                    <button id="save-influxdb-btn" class="flex-1 px-4 py-3 bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white rounded-xl transition-all duration-300 font-medium text-sm hover:shadow-lg hover:shadow-green-500/25 hover:scale-105 flex items-center justify-center gap-2">
                      <i class="fas fa-save"></i>
                      <span>Save Settings</span>
                    </button>
                  </div>

                  <!-- Connection Status -->
                  <div id="influxdb-status" class="hidden p-4 rounded-xl border">
                    <div class="flex items-center gap-3">
                      <div id="status-icon" class="w-5 h-5"></div>
                      <p id="influxdb-status-text" class="text-sm font-medium"></p>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Monitoring Settings -->
              <div class="bg-gradient-to-br from-slate-800 to-slate-900 rounded-xl border border-slate-700/50 p-6 shadow-xl hover:shadow-2xl transition-all duration-300 group">
                <div class="flex items-start justify-between mb-6">
                  <div>
                    <h3 class="text-lg font-bold text-white flex items-center gap-2">
                      <div class="w-8 h-8 bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg flex items-center justify-center shadow-lg group-hover:scale-110 transition-transform duration-200">
                        <i class="fas fa-chart-line text-white text-sm"></i>
                      </div>
                      Monitoring Settings
                    </h3>
                    <p class="text-sm text-gray-400 mt-1">Configure data collection intervals</p>
                  </div>
                  <div class="flex items-center gap-2">
                    <div class="w-3 h-3 bg-blue-500 rounded-full animate-pulse"></div>
                    <span class="text-xs text-gray-400">Active</span>
                  </div>
                </div>

                <div class="space-y-6">
                  <!-- SNMP Polling Interval -->
                  <div>
                    <label class="block text-sm font-medium text-gray-300 mb-3 flex items-center gap-2">
                      <i class="fas fa-sync-alt text-blue-400 text-xs"></i>
                      SNMP Polling Interval
                    </label>
                    <div class="space-y-3">
                      <input type="range"
                             id="polling-interval-slider"
                             min="30"
                             max="1800"
                             step="30"
                             value="<%= settings.pollingInterval / 1000 %>"
                             class="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer slider">
                      <div class="flex justify-between text-xs text-gray-400">
                        <span>30s</span>
                        <span id="polling-current-value" class="font-medium text-blue-400"><%= settings.pollingInterval / 1000 %>s</span>
                        <span>30m</span>
                      </div>
                    </div>
                    <p class="text-xs text-gray-500 mt-2">How often to poll SNMP devices (30 seconds - 30 minutes)</p>
                  </div>

                  <!-- Ping Monitoring Interval -->
          <a href="/websites" class="flex items-center gap-3 px-4 py-3 rounded-lg text-gray-300 hover:bg-slate-700 transition-all duration-200">
            <i class="fas fa-globe w-5"></i>
            <span>Website Monitor</span>
          </a>
                  <div>
                    <label class="block text-sm font-medium text-gray-300 mb-3 flex items-center gap-2">
                      <i class="fas fa-network-wired text-blue-400 text-xs"></i>
                      Ping Monitoring Interval
          <a href="/websites" class="flex items-center gap-3 px-4 py-3 rounded-lg text-gray-300 hover:bg-slate-700 transition-all duration-200">
            <i class="fas fa-globe w-5"></i>
            <span>Website Monitor</span>
          </a>
                    </label>
                    <div class="space-y-3">
                      <input type="range"
                             id="ping-interval-slider"
                             min="5"
                             max="300"
                             step="5"
                             value="<%= settings.pingInterval / 1000 %>"
                             class="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer slider">
                      <div class="flex justify-between text-xs text-gray-400">
                        <span>5s</span>
                        <span id="ping-current-value" class="font-medium text-blue-400"><%= settings.pingInterval / 1000 %>s</span>
                        <span>5m</span>
                      </div>
                    </div>
                    <p class="text-xs text-gray-500 mt-2">How often to ping network targets (5 seconds - 5 minutes)</p>
                  </div>

                  <!-- Data Retention -->
                  <div>
                    <label class="block text-sm font-medium text-gray-300 mb-3 flex items-center gap-2">
                      <i class="fas fa-calendar-alt text-blue-400 text-xs"></i>
                      Data Retention Period
                    </label>
                    <div class="space-y-3">
                      <input type="range"
                             id="retention-slider"
                             min="7"
                             max="730"
                             step="7"
                             value="<%= settings.dataRetention || 730 %>"
                             class="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer slider">
                      <div class="flex justify-between text-xs text-gray-400">
                        <span>1 week</span>
                        <span id="retention-current-value" class="font-medium text-blue-400"><%= settings.dataRetention || 730 %> days</span>
                        <span>2 years</span>
                      </div>
                    </div>
                    <p class="text-xs text-gray-500 mt-2">How long to keep historical data (7 days - 2 years)</p>
                  </div>

                  <!-- Save Button -->
                  <div class="pt-2">
                    <button id="save-general-btn" class="w-full px-4 py-3 bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white rounded-xl transition-all duration-300 font-medium text-sm hover:shadow-lg hover:shadow-green-500/25 hover:scale-105 flex items-center justify-center gap-2">
                      <i class="fas fa-save"></i>
                      <span>Save Monitoring Settings</span>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Notification Settings Section -->
          <div class="space-y-6">
            <div class="flex items-center gap-3">
              <div class="w-8 h-8 bg-gradient-to-br from-yellow-500 to-yellow-600 rounded-lg flex items-center justify-center shadow-lg">
                <i class="fas fa-bell text-white text-sm"></i>
              </div>
              <h2 class="text-xl font-bold text-white">Notification Settings</h2>
            </div>

            <div class="grid grid-cols-1 xl:grid-cols-2 gap-6">
              <!-- Ping Notifications -->
              <div class="bg-gradient-to-br from-slate-800 to-slate-900 rounded-xl border border-slate-700/50 p-6 shadow-xl hover:shadow-2xl transition-all duration-300 group">
                <div class="flex items-start justify-between mb-6">
                  <div>
                    <h3 class="text-lg font-bold text-white flex items-center gap-2">
                      <div class="w-8 h-8 bg-gradient-to-br from-green-500 to-green-600 rounded-lg flex items-center justify-center shadow-lg group-hover:scale-110 transition-transform duration-200">
                        <i class="fas fa-network-wired text-white text-sm"></i>
                      </div>
                      Ping Notifications
                    </h3>
                    <p class="text-sm text-gray-400 mt-1">Configure alerts for network connectivity</p>
                  </div>
                  <div class="flex items-center gap-2">
                    <div class="w-3 h-3 bg-green-500 rounded-full animate-pulse"></div>
                    <span class="text-xs text-gray-400">Monitoring</span>
                  </div>
                </div>

                <div class="space-y-4">
                  <!-- Enable Ping Notifications -->
                  <div class="flex items-center justify-between bg-gradient-to-br from-slate-700/50 to-slate-800/50 rounded-xl p-4 border border-slate-600/30">
                    <div class="flex items-center gap-3">
                      <div class="w-8 h-8 bg-gradient-to-br from-green-500 to-green-600 rounded-lg flex items-center justify-center shadow-md">
                        <i class="fas fa-bell text-white text-sm"></i>
                      </div>
                      <div>
                        <p class="text-sm font-medium text-white">Enable Ping Notifications</p>
                        <p class="text-xs text-gray-400">Show alerts for ping failures and recoveries</p>
                      </div>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                      <input type="checkbox" id="ping-notifications-enabled" class="sr-only peer" <%= settings.pingNotifications?.enabled ? 'checked' : '' %>>
                      <div class="w-11 h-6 bg-slate-600 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-green-500 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"></div>
                    </label>
                  </div>

                  <!-- Individual Ping Alerts -->
                  <div class="grid grid-cols-1 gap-3">
                    <div class="flex items-center justify-between bg-slate-700/30 rounded-lg p-3 hover:bg-slate-700/50 transition-colors duration-200">
                      <div class="flex items-center gap-3">
                        <i class="fas fa-times-circle text-red-400"></i>
                        <div>
                          <p class="text-sm font-medium text-white">Target Offline</p>
                          <p class="text-xs text-gray-400">Alert when ping targets go down</p>
                        </div>
                      </div>
                      <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="ping-notify-down" class="sr-only peer" <%= settings.pingNotifications?.notifyOnDown ? 'checked' : '' %>>
                        <div class="w-11 h-6 bg-slate-600 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-green-500 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"></div>
                      </label>
                    </div>

                    <div class="flex items-center justify-between bg-slate-700/30 rounded-lg p-3 hover:bg-slate-700/50 transition-colors duration-200">
                      <div class="flex items-center gap-3">
                        <i class="fas fa-clock text-orange-400"></i>
                        <div>
                          <p class="text-sm font-medium text-white">Ping Timeout</p>
                          <p class="text-xs text-gray-400">Alert when ping requests timeout</p>
                        </div>
                      </div>
                      <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="ping-notify-timeout" class="sr-only peer" <%= settings.pingNotifications?.notifyOnTimeout ? 'checked' : '' %>>
                        <div class="w-11 h-6 bg-slate-600 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-green-500 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"></div>
                      </label>
                    </div>

                    <div class="flex items-center justify-between bg-slate-700/30 rounded-lg p-3 hover:bg-slate-700/50 transition-colors duration-200">
                      <div class="flex items-center gap-3">
                        <i class="fas fa-tachometer-alt text-yellow-400"></i>
                        <div>
                          <p class="text-sm font-medium text-white">High Latency</p>
                          <p class="text-xs text-gray-400">Alert when ping latency is high</p>
                        </div>
                      </div>
                      <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="ping-notify-high-latency" class="sr-only peer" <%= settings.pingNotifications?.notifyOnHighLatency ? 'checked' : '' %>>
                        <div class="w-11 h-6 bg-slate-600 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-green-500 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"></div>
                      </label>
                    </div>
                  </div>

                  <!-- Latency Threshold -->
                  <div class="bg-slate-700/30 rounded-lg p-4">
                    <label class="block text-sm font-medium text-gray-300 mb-3 flex items-center gap-2">
                      <i class="fas fa-stopwatch text-green-400 text-xs"></i>
                      Latency Threshold
                    </label>
                    <div class="flex gap-3">
                      <input type="number"
                             id="ping-latency-threshold"
                             min="10"
                             step="5"
                             value="<%= settings.pingNotifications?.latencyThreshold || 50 %>"
                             class="flex-1 bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-green-500 text-center">
                      <span class="flex items-center text-gray-400 font-medium">ms</span>
                    </div>
                    <p class="text-xs text-gray-500 mt-2">Trigger high latency alert when ping exceeds this value</p>
                  </div>

                  <!-- Save Button -->
                  <div class="pt-2">
                    <button id="save-ping-notifications-btn" class="w-full px-4 py-3 bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white rounded-xl transition-all duration-300 font-medium text-sm hover:shadow-lg hover:shadow-green-500/25 hover:scale-105 flex items-center justify-center gap-2">
                      <i class="fas fa-save"></i>
                      <span>Save Ping Settings</span>
                    </button>
                  </div>
                </div>
              </div>

              <!-- Website Monitoring Settings -->
              <div class="bg-gradient-to-br from-slate-800 to-slate-900 rounded-xl border border-slate-700/50 p-6 shadow-xl hover:shadow-2xl transition-all duration-300 group">
                <div class="flex items-start justify-between mb-6">
                  <div>
                    <h3 class="text-lg font-bold text-white flex items-center gap-2">
                      <div class="w-8 h-8 bg-gradient-to-br from-green-500 to-green-600 rounded-lg flex items-center justify-center shadow-lg group-hover:scale-110 transition-transform duration-200">
                        <i class="fas fa-globe text-white text-sm"></i>
                      </div>
                      Website Monitoring
                    </h3>
                    <p class="text-sm text-gray-400 mt-1">Monitor website availability and SSL certificates</p>
                  </div>
                  <div class="flex items-center gap-2">
                    <div class="w-3 h-3 bg-green-500 rounded-full animate-pulse"></div>
                    <span class="text-xs text-gray-400">Active</span>
                  </div>
                </div>

                <div class="space-y-4">
                  <!-- Enable Website Monitoring -->
                  <div class="flex items-center justify-between bg-gradient-to-br from-slate-700/50 to-slate-800/50 rounded-xl p-4 border border-slate-600/30">
                    <div class="flex items-center gap-3">
                      <div class="w-8 h-8 bg-gradient-to-br from-green-500 to-green-600 rounded-lg flex items-center justify-center shadow-md">
                        <i class="fas fa-globe text-white text-sm"></i>
                      </div>
                      <div>
                        <p class="text-sm font-medium text-white">Enable Website Monitoring</p>
                        <p class="text-xs text-gray-400">Monitor website uptime and SSL certificates</p>
                      </div>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                      <input type="checkbox" id="website-enabled" class="sr-only peer" <%= settings.website?.enabled ? 'checked' : '' %>>
                      <div class="w-11 h-6 bg-slate-600 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-green-500 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"></div>
                    </label>
                  </div>

                  <!-- Monitoring Interval -->
                  <div class="bg-slate-700/30 rounded-lg p-4">
                    <label class="block text-sm font-medium text-gray-300 mb-3 flex items-center gap-2">
                      <i class="fas fa-clock text-green-400 text-xs"></i>
                      Monitoring Interval
                    </label>
                    <div class="flex gap-3">
                      <input type="number"
                             id="website-interval"
                             min="30000"
                             step="30000"
                             value="<%= settings.website?.interval || 300000 %>"
                             class="flex-1 bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-green-500 text-center">
                      <span class="flex items-center text-gray-400 font-medium">ms</span>
                    </div>
                    <p class="text-xs text-gray-500 mt-2">How often to check websites (minimum 30 seconds)</p>
                  </div>

                  <!-- Timeout -->
                  <div class="bg-slate-700/30 rounded-lg p-4">
                    <label class="block text-sm font-medium text-gray-300 mb-3 flex items-center gap-2">
                      <i class="fas fa-hourglass-half text-orange-400 text-xs"></i>
                      Request Timeout
                    </label>
                    <div class="flex gap-3">
                      <input type="number"
                             id="website-timeout"
                             min="1000"
                             step="1000"
                             value="<%= settings.website?.timeout || 10000 %>"
                             class="flex-1 bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-green-500 text-center">
                      <span class="flex items-center text-gray-400 font-medium">ms</span>
                    </div>
                    <p class="text-xs text-gray-500 mt-2">Maximum time to wait for website response</p>
                  </div>

                  <!-- Website Notifications -->
                  <div class="bg-slate-700/30 rounded-lg p-4">
                    <div class="flex items-center gap-3 mb-4">
                      <div class="w-8 h-8 bg-gradient-to-br from-green-500 to-green-600 rounded-lg flex items-center justify-center shadow-md">
                        <i class="fas fa-bell text-white text-sm"></i>
                      </div>
                      <div>
                        <p class="text-sm font-medium text-white">Website Notifications</p>
                        <p class="text-xs text-gray-400">Alert settings for website monitoring</p>
                      </div>
                    </div>

                    <!-- Individual Website Alerts -->
                    <div class="grid grid-cols-1 gap-3">
                      <div class="flex items-center justify-between bg-slate-700/30 rounded-lg p-3 hover:bg-slate-700/50 transition-colors duration-200">
                        <div class="flex items-center gap-3">
                          <i class="fas fa-times-circle text-red-400"></i>
                          <div>
                            <p class="text-sm font-medium text-white">Website Offline</p>
                            <p class="text-xs text-gray-400">Alert when websites go down</p>
                          </div>
                        </div>
                        <label class="relative inline-flex items-center cursor-pointer">
                          <input type="checkbox" id="website-notify-down" class="sr-only peer" <%= settings.website?.notifyOnDown ? 'checked' : '' %>>
                          <div class="w-11 h-6 bg-slate-600 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-green-500 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"></div>
                        </label>
                      </div>

                      <div class="flex items-center justify-between bg-slate-700/30 rounded-lg p-3 hover:bg-slate-700/50 transition-colors duration-200">
                        <div class="flex items-center gap-3">
                          <i class="fas fa-check-circle text-green-400"></i>
                          <div>
                            <p class="text-sm font-medium text-white">Website Online</p>
                            <p class="text-xs text-gray-400">Alert when websites come back online</p>
                          </div>
                        </div>
                        <label class="relative inline-flex items-center cursor-pointer">
                          <input type="checkbox" id="website-notify-up" class="sr-only peer" <%= settings.website?.notifyOnUp ? 'checked' : '' %>>
                          <div class="w-11 h-6 bg-slate-600 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-green-500 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"></div>
                        </label>
                      </div>

                      <div class="flex items-center justify-between bg-slate-700/30 rounded-lg p-3 hover:bg-slate-700/50 transition-colors duration-200">
                        <div class="flex items-center gap-3">
                          <i class="fas fa-shield-alt text-blue-400"></i>
                          <div>
                            <p class="text-sm font-medium text-white">SSL Expiry Warning</p>
                            <p class="text-xs text-gray-400">Alert when SSL certificates are expiring</p>
                          </div>
                        </div>
                        <label class="relative inline-flex items-center cursor-pointer">
                          <input type="checkbox" id="website-notify-ssl-expiry" class="sr-only peer" <%= settings.website?.notifyOnSslExpiry ? 'checked' : '' %>>
                          <div class="w-11 h-6 bg-slate-600 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-green-500 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"></div>
                        </label>
                      </div>
                    </div>

                    <!-- SSL Expiry Warning Days -->
                    <div class="mt-4">
                      <label class="block text-sm font-medium text-gray-300 mb-3 flex items-center gap-2">
                        <i class="fas fa-calendar-alt text-blue-400 text-xs"></i>
                        SSL Expiry Warning
                      </label>
                      <div class="flex gap-3">
                        <input type="number"
                               id="website-ssl-expiry-days"
                               min="1"
                               max="90"
                               value="<%= settings.website?.sslExpiryWarningDays || 30 %>"
                               class="flex-1 bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-green-500 text-center">
                        <span class="flex items-center text-gray-400 font-medium">days</span>
                      </div>
                      <p class="text-xs text-gray-500 mt-2">Warn when SSL certificates expire within this many days</p>
                    </div>
                  </div>

                  <!-- Save Button -->
                  <div class="pt-2">
                    <button id="save-website-settings-btn" class="w-full px-4 py-3 bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white rounded-xl transition-all duration-300 font-medium text-sm hover:shadow-lg hover:shadow-green-500/25 hover:scale-105 flex items-center justify-center gap-2">
                      <i class="fas fa-save"></i>
                      <span>Save Website Settings</span>
                    </button>
                  </div>
                </div>
              </div>

              <!-- Telegram Bot Notifications -->
              <div class="bg-gradient-to-br from-slate-800 to-slate-900 rounded-xl border border-slate-700/50 p-6 shadow-xl hover:shadow-2xl transition-all duration-300 group">
                <div class="flex items-start justify-between mb-6">
                  <div>
                    <h3 class="text-lg font-bold text-white flex items-center gap-2">
                      <div class="w-8 h-8 bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg flex items-center justify-center shadow-lg group-hover:scale-110 transition-transform duration-200">
                        <i class="fab fa-telegram-plane text-white text-sm"></i>
                      </div>
                      Telegram Notifications
                    </h3>
                    <p class="text-sm text-gray-400 mt-1">Real-time alerts via Telegram bot</p>
                  </div>
                  <div class="flex items-center gap-2">
                    <div class="w-3 h-3 bg-blue-500 rounded-full animate-pulse"></div>
                    <span class="text-xs text-gray-400">Bot Active</span>
                  </div>
                </div>

                <div class="space-y-4">
                  <!-- Enable Telegram Bot -->
                  <div class="flex items-center justify-between bg-gradient-to-br from-slate-700/50 to-slate-800/50 rounded-xl p-4 border border-slate-600/30">
                    <div class="flex items-center gap-3">
                      <div class="w-8 h-8 bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg flex items-center justify-center shadow-md">
                        <i class="fab fa-telegram-plane text-white text-sm"></i>
                      </div>
                      <div>
                        <p class="text-sm font-medium text-white">Enable Telegram Bot</p>
                        <p class="text-xs text-gray-400">Send notifications to Telegram</p>
                      </div>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                      <input type="checkbox" id="telegram-enabled" class="sr-only peer" <%= settings.telegram?.enabled ? 'checked' : '' %>>
                      <div class="w-11 h-6 bg-slate-600 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-500 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                    </label>
                  </div>

                  <!-- Bot Configuration -->
                  <div class="grid grid-cols-1 gap-4">
                    <div>
                      <label class="block text-sm font-medium text-gray-300 mb-2 flex items-center gap-2">
                        <i class="fas fa-robot text-blue-400 text-xs"></i>
                        Bot Token
                      </label>
                      <input type="password"
                             id="telegram-bot-token"
                             value="<%= settings.telegram?.botToken || '' %>"
                             placeholder="123456789:ABCdefGHIjklMNOpqrsTUVwxyz..."
                             class="w-full bg-gradient-to-br from-slate-700 to-slate-800 border border-slate-600/50 rounded-xl px-4 py-3 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 hover:border-slate-500/70">
                      <p class="text-xs text-gray-500 mt-1">Get token from @BotFather on Telegram</p>
                    </div>

                    <div>
                      <label class="block text-sm font-medium text-gray-300 mb-2 flex items-center gap-2">
                        <i class="fas fa-comment text-blue-400 text-xs"></i>
                        Chat ID
                      </label>
                      <input type="text"
                             id="telegram-chat-id"
                             value="<%= settings.telegram?.chatId || '' %>"
                             placeholder="-123456789"
                             class="w-full bg-gradient-to-br from-slate-700 to-slate-800 border border-slate-600/50 rounded-xl px-4 py-3 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 hover:border-slate-500/70">
                      <p class="text-xs text-gray-500 mt-1">Your Telegram chat ID (use @userinfobot)</p>
                    </div>
                  </div>

                  <!-- Device Notification Settings -->
                  <div class="space-y-3">
                    <h4 class="text-sm font-medium text-gray-300 flex items-center gap-2">
                      <i class="fas fa-server text-blue-400 text-xs"></i>
                      Device Monitoring
                    </h4>

                    <div class="grid grid-cols-1 gap-2">
                      <div class="flex items-center justify-between bg-slate-700/30 rounded-lg p-3 hover:bg-slate-700/50 transition-colors duration-200">
                        <div class="flex items-center gap-3">
                          <i class="fas fa-server text-red-400"></i>
                          <div>
                            <p class="text-sm font-medium text-white">Device Offline</p>
                            <p class="text-xs text-gray-400">Alert when SNMP devices go down</p>
                          </div>
                        </div>
                        <label class="relative inline-flex items-center cursor-pointer">
                          <input type="checkbox" id="telegram-notify-device-down" class="sr-only peer" <%= settings.telegram?.notifyOnDeviceDown ? 'checked' : '' %>>
                          <div class="w-11 h-6 bg-slate-600 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-500 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                        </label>
                      </div>

                      <div class="flex items-center justify-between bg-slate-700/30 rounded-lg p-3 hover:bg-slate-700/50 transition-colors duration-200">
                        <div class="flex items-center gap-3">
                          <i class="fas fa-server text-green-400"></i>
                          <div>
                            <p class="text-sm font-medium text-white">Device Online</p>
                            <p class="text-xs text-gray-400">Alert when devices come back up</p>
                          </div>
                        </div>
                        <label class="relative inline-flex items-center cursor-pointer">
                          <input type="checkbox" id="telegram-notify-device-up" class="sr-only peer" <%= settings.telegram?.notifyOnDeviceUp ? 'checked' : '' %>>
                          <div class="w-11 h-6 bg-slate-600 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-500 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                        </label>
                      </div>

                      <div class="flex items-center justify-between bg-slate-700/30 rounded-lg p-3 hover:bg-slate-700/50 transition-colors duration-200">
                        <div class="flex items-center gap-3">
                          <i class="fas fa-microchip text-yellow-400"></i>
                          <div>
                            <p class="text-sm font-medium text-white">High CPU Usage</p>
                            <p class="text-xs text-gray-400">Alert when CPU usage is high</p>
                          </div>
                        </div>
                        <label class="relative inline-flex items-center cursor-pointer">
                          <input type="checkbox" id="telegram-notify-high-cpu" class="sr-only peer" <%= settings.telegram?.notifyOnHighCpu ? 'checked' : '' %>>
                          <div class="w-11 h-6 bg-slate-600 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-500 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                        </label>
                      </div>
                    </div>
                  </div>

                  <!-- Ping Notification Settings -->
                  <div class="space-y-3">
                    <h4 class="text-sm font-medium text-gray-300 flex items-center gap-2">
                      <i class="fas fa-network-wired text-blue-400 text-xs"></i>
                      Network Monitoring
                    </h4>

                    <div class="grid grid-cols-1 gap-2">
                      <div class="flex items-center justify-between bg-slate-700/30 rounded-lg p-3 hover:bg-slate-700/50 transition-colors duration-200">
                        <div class="flex items-center gap-3">
                          <i class="fas fa-times-circle text-red-400"></i>
                          <div>
                            <p class="text-sm font-medium text-white">Ping Target Down</p>
                            <p class="text-xs text-gray-400">Alert when ping targets go offline</p>
                          </div>
                        </div>
                        <label class="relative inline-flex items-center cursor-pointer">
                          <input type="checkbox" id="telegram-notify-ping-down" class="sr-only peer" <%= settings.telegram?.notifyOnPingDown ? 'checked' : '' %>>
                          <div class="w-11 h-6 bg-slate-600 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-500 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                        </label>
                      </div>

                      <div class="flex items-center justify-between bg-slate-700/30 rounded-lg p-3 hover:bg-slate-700/50 transition-colors duration-200">
                        <div class="flex items-center gap-3">
                          <i class="fas fa-check-circle text-green-400"></i>
                          <div>
                            <p class="text-sm font-medium text-white">Ping Target Up</p>
                            <p class="text-xs text-gray-400">Alert when targets recover</p>
                          </div>
                        </div>
                        <label class="relative inline-flex items-center cursor-pointer">
                          <input type="checkbox" id="telegram-notify-ping-up" class="sr-only peer" <%= settings.telegram?.notifyOnPingUp ? 'checked' : '' %>>
                          <div class="w-11 h-6 bg-slate-600 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-500 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                        </label>
                      </div>

                      <div class="flex items-center justify-between bg-slate-700/30 rounded-lg p-3 hover:bg-slate-700/50 transition-colors duration-200">
                        <div class="flex items-center gap-3">
                          <i class="fas fa-clock text-orange-400"></i>
                          <div>
                            <p class="text-sm font-medium text-white">Ping Timeout</p>
                            <p class="text-xs text-gray-400">Alert when ping requests timeout</p>
                          </div>
                        </div>
                        <label class="relative inline-flex items-center cursor-pointer">
                          <input type="checkbox" id="telegram-notify-ping-timeout" class="sr-only peer" <%= settings.telegram?.notifyOnPingTimeout ? 'checked' : '' %>>
                          <div class="w-11 h-6 bg-slate-600 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-500 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                        </label>
                      </div>

                      <div class="flex items-center justify-between bg-slate-700/30 rounded-lg p-3 hover:bg-slate-700/50 transition-colors duration-200">
                        <div class="flex items-center gap-3">
                          <i class="fas fa-tachometer-alt text-yellow-400"></i>
                          <div>
                            <p class="text-sm font-medium text-white">High Ping Latency</p>
                            <p class="text-xs text-gray-400">Alert when latency exceeds threshold</p>
                          </div>
                        </div>
                        <label class="relative inline-flex items-center cursor-pointer">
                          <input type="checkbox" id="telegram-notify-ping-high-latency" class="sr-only peer" <%= settings.telegram?.notifyOnPingHighLatency ? 'checked' : '' %>>
                          <div class="w-11 h-6 bg-slate-600 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-500 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                        </label>
                      </div>
                    </div>
                  </div>

                  <!-- Thresholds -->
                  <div class="grid grid-cols-1 gap-3">
                    <div class="bg-slate-700/30 rounded-lg p-4">
                      <label class="block text-sm font-medium text-gray-300 mb-2 flex items-center gap-2">
                        <i class="fas fa-microchip text-blue-400 text-xs"></i>
                        CPU Alert Threshold
                      </label>
                      <div class="flex gap-3">
                        <input type="number"
                               id="telegram-cpu-threshold"
                               min="1"
                               max="100"
                               value="<%= settings.telegram?.cpuThreshold || 80 %>"
                               class="flex-1 bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500 text-center">
                        <span class="flex items-center text-gray-400 font-medium">%</span>
                      </div>
                    </div>

                    <div class="bg-slate-700/30 rounded-lg p-4">
                      <label class="block text-sm font-medium text-gray-300 mb-2 flex items-center gap-2">
                        <i class="fas fa-stopwatch text-blue-400 text-xs"></i>
                        Ping Latency Threshold
                      </label>
                      <div class="flex gap-3">
                        <input type="number"
                               id="telegram-ping-latency-threshold"
                               min="10"
                               step="5"
                               value="<%= settings.telegram?.pingLatencyThreshold || 50 %>"
                               class="flex-1 bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500 text-center">
                        <span class="flex items-center text-gray-400 font-medium">ms</span>
                      </div>
                    </div>
                  </div>

                  <!-- Action Buttons -->
                  <div class="flex gap-3 pt-2">
                    <button id="save-telegram-btn" class="flex-1 px-4 py-3 bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white rounded-xl transition-all duration-300 font-medium text-sm hover:shadow-lg hover:shadow-green-500/25 hover:scale-105 flex items-center justify-center gap-2">
                      <i class="fas fa-save"></i>
                      <span>Save Settings</span>
                    </button>
                    <button id="test-telegram-btn" class="px-4 py-3 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white rounded-xl transition-all duration-300 font-medium text-sm hover:shadow-lg hover:shadow-blue-500/25 hover:scale-105 flex items-center justify-center gap-2">
                      <i class="fas fa-paper-plane"></i>
                      <span>Test</span>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Email Settings Section -->
          <div class="space-y-6">
            <div class="flex items-center gap-3">
              <div class="w-8 h-8 bg-gradient-to-br from-red-500 to-red-600 rounded-lg flex items-center justify-center shadow-lg">
                <i class="fas fa-envelope text-white text-sm"></i>
              </div>
              <h2 class="text-xl font-bold text-white">Email Notifications</h2>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
              <!-- SMTP Configuration -->
              <div class="bg-gradient-to-br from-slate-800 to-slate-900 rounded-xl border border-slate-700/50 p-6 shadow-xl hover:shadow-2xl transition-all duration-300">
                <h3 class="text-lg font-bold text-white flex items-center gap-2 mb-6">
                  <div class="w-6 h-6 bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg flex items-center justify-center shadow-lg">
                    <i class="fas fa-cog text-white text-sm"></i>
                  </div>
                  SMTP Configuration
                </h3>

                <div class="space-y-4">
                  <div class="grid grid-cols-1 gap-4">
                    <div>
                      <label class="block text-sm font-medium text-gray-300 mb-2">SMTP Host</label>
                      <input type="text"
                             id="email-smtp-host"
                             value="<%= settings.email?.smtp?.host || '' %>"
                             placeholder="smtp.gmail.com"
                             class="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                      <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">SMTP Port</label>
                        <input type="number"
                               id="email-smtp-port"
                               value="<%= settings.email?.smtp?.port || 587 %>"
                               min="1"
                               max="65535"
                               class="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                      </div>

                      <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Security</label>
                        <select id="email-smtp-secure" class="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                          <option value="false" <%= settings.email?.smtp?.secure === false ? 'selected' : '' %>>STARTTLS</option>
                          <option value="true" <%= settings.email?.smtp?.secure === true ? 'selected' : '' %>>SSL/TLS</option>
                        </select>
                      </div>
                    </div>

                    <div>
                      <label class="block text-sm font-medium text-gray-300 mb-2">Username</label>
                      <input type="text"
                             id="email-smtp-user"
                             value="<%= settings.email?.smtp?.user || '' %>"
                             placeholder="your-email@gmail.com"
                             class="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>

                    <div>
                      <label class="block text-sm font-medium text-gray-300 mb-2">Password</label>
                      <input type="password"
                             id="email-smtp-pass"
                             value="<%= settings.email?.smtp?.pass || '' %>"
                             placeholder="App password or SMTP password"
                             class="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>

                    <div>
                      <label class="block text-sm font-medium text-gray-300 mb-2">From Email</label>
                      <input type="email"
                             id="email-from"
                             value="<%= settings.email?.from || '' %>"
                             placeholder="alerts@yourdomain.com"
                             class="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>

                    <div>
                      <label class="block text-sm font-medium text-gray-300 mb-2">To Email</label>
                      <input type="email"
                             id="email-to"
                             value="<%= settings.email?.to || '' %>"
                             placeholder="admin@yourdomain.com"
                             class="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                  </div>
                </div>
              </div>

              <!-- Email Notification Preferences -->
              <div class="bg-gradient-to-br from-slate-800 to-slate-900 rounded-xl border border-slate-700/50 p-6 shadow-xl hover:shadow-2xl transition-all duration-300">
                <h3 class="text-lg font-bold text-white flex items-center gap-2 mb-6">
                  <div class="w-6 h-6 bg-gradient-to-br from-green-500 to-green-600 rounded-lg flex items-center justify-center shadow-lg">
                    <i class="fas fa-bell text-white text-sm"></i>
                  </div>
                  Notification Preferences
                </h3>

                <div class="space-y-4">
                  <!-- Device Status Notifications -->
                  <div class="bg-slate-700/30 rounded-lg p-4">
                    <h4 class="text-sm font-medium text-gray-300 mb-3 flex items-center gap-2">
                      <i class="fas fa-server text-blue-400 text-xs"></i>
                      Device Status Alerts
                    </h4>
                    <div class="space-y-3">
                      <div class="flex items-center justify-between">
                        <div class="flex items-center gap-3">
                          <i class="fas fa-arrow-up text-green-400"></i>
                          <div>
                            <p class="text-sm font-medium text-white">Device Up</p>
                            <p class="text-xs text-gray-400">Alert when device comes online</p>
                          </div>
                        </div>
                        <label class="relative inline-flex items-center cursor-pointer">
                          <input type="checkbox" id="email-notify-device-up" class="sr-only peer" <%= settings.email?.notifyOnDeviceUp ? 'checked' : '' %>>
                          <div class="w-11 h-6 bg-slate-600 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-500 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                        </label>
                      </div>

                      <div class="flex items-center justify-between">
                        <div class="flex items-center gap-3">
                          <i class="fas fa-arrow-down text-red-400"></i>
                          <div>
                            <p class="text-sm font-medium text-white">Device Down</p>
                            <p class="text-xs text-gray-400">Alert when device goes offline</p>
                          </div>
                        </div>
                        <label class="relative inline-flex items-center cursor-pointer">
                          <input type="checkbox" id="email-notify-device-down" class="sr-only peer" <%= settings.email?.notifyOnDeviceDown ? 'checked' : '' %>>
                          <div class="w-11 h-6 bg-slate-600 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-500 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                        </label>
                      </div>
                    </div>
                  </div>

                  <!-- CPU Usage Notifications -->
                  <div class="bg-slate-700/30 rounded-lg p-4">
                    <h4 class="text-sm font-medium text-gray-300 mb-3 flex items-center gap-2">
                      <i class="fas fa-microchip text-yellow-400 text-xs"></i>
                      CPU Usage Alerts
                    </h4>
                    <div class="flex items-center justify-between">
                      <div class="flex items-center gap-3">
                        <i class="fas fa-exclamation-triangle text-orange-400"></i>
                        <div>
                          <p class="text-sm font-medium text-white">High CPU Usage</p>
                          <p class="text-xs text-gray-400">Alert when CPU exceeds threshold</p>
                        </div>
                      </div>
                      <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="email-notify-high-cpu" class="sr-only peer" <%= settings.email?.notifyOnHighCpu ? 'checked' : '' %>>
                        <div class="w-11 h-6 bg-slate-600 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-500 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                      </label>
                    </div>
                  </div>

                  <!-- Ping Notifications -->
                  <div class="bg-slate-700/30 rounded-lg p-4">
                    <h4 class="text-sm font-medium text-gray-300 mb-3 flex items-center gap-2">
                      <i class="fas fa-network-wired text-purple-400 text-xs"></i>
                      Ping Status Alerts
                    </h4>
                    <div class="space-y-3">
                      <div class="flex items-center justify-between">
                        <div class="flex items-center gap-3">
                          <i class="fas fa-check-circle text-green-400"></i>
                          <div>
                            <p class="text-sm font-medium text-white">Ping Up</p>
                            <p class="text-xs text-gray-400">Alert when ping responds</p>
                          </div>
                        </div>
                        <label class="relative inline-flex items-center cursor-pointer">
                          <input type="checkbox" id="email-notify-ping-up" class="sr-only peer" <%= settings.email?.notifyOnPingUp ? 'checked' : '' %>>
                          <div class="w-11 h-6 bg-slate-600 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-500 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                        </label>
                      </div>

                      <div class="flex items-center justify-between">
                        <div class="flex items-center gap-3">
                          <i class="fas fa-clock text-orange-400"></i>
                          <div>
                            <p class="text-sm font-medium text-white">Ping Timeout</p>
                            <p class="text-xs text-gray-400">Alert when ping requests timeout</p>
                          </div>
                        </div>
                        <label class="relative inline-flex items-center cursor-pointer">
                          <input type="checkbox" id="email-notify-ping-timeout" class="sr-only peer" <%= settings.email?.notifyOnPingTimeout ? 'checked' : '' %>>
                          <div class="w-11 h-6 bg-slate-600 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-500 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                        </label>
                      </div>

                      <div class="flex items-center justify-between">
                        <div class="flex items-center gap-3">
                          <i class="fas fa-tachometer-alt text-yellow-400"></i>
                          <div>
                            <p class="text-sm font-medium text-white">High Ping Latency</p>
                            <p class="text-xs text-gray-400">Alert when latency exceeds threshold</p>
                          </div>
                        </div>
                        <label class="relative inline-flex items-center cursor-pointer">
                          <input type="checkbox" id="email-notify-ping-high-latency" class="sr-only peer" <%= settings.email?.notifyOnPingHighLatency ? 'checked' : '' %>>
                          <div class="w-11 h-6 bg-slate-600 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-500 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                        </label>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Thresholds and Actions -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
              <!-- Thresholds -->
              <div class="bg-gradient-to-br from-slate-800 to-slate-900 rounded-xl border border-slate-700/50 p-6 shadow-xl hover:shadow-2xl transition-all duration-300">
                <h3 class="text-lg font-bold text-white flex items-center gap-2 mb-6">
                  <div class="w-6 h-6 bg-gradient-to-br from-orange-500 to-orange-600 rounded-lg flex items-center justify-center shadow-lg">
                    <i class="fas fa-sliders-h text-white text-sm"></i>
                  </div>
                  Alert Thresholds
                </h3>

                <div class="space-y-4">
                  <div class="bg-slate-700/30 rounded-lg p-4">
                    <label class="block text-sm font-medium text-gray-300 mb-2 flex items-center gap-2">
                      <i class="fas fa-microchip text-blue-400 text-xs"></i>
                      CPU Alert Threshold
                    </label>
                    <div class="flex gap-3">
                      <input type="number"
                             id="email-cpu-threshold"
                             min="1"
                             max="100"
                             value="<%= settings.email?.cpuThreshold || 80 %>"
                             class="flex-1 bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500 text-center">
                      <span class="flex items-center text-gray-400 font-medium">%</span>
                    </div>
                  </div>

                  <div class="bg-slate-700/30 rounded-lg p-4">
                    <label class="block text-sm font-medium text-gray-300 mb-2 flex items-center gap-2">
                      <i class="fas fa-stopwatch text-blue-400 text-xs"></i>
                      Ping Latency Threshold
                    </label>
                    <div class="flex gap-3">
                      <input type="number"
                             id="email-ping-latency-threshold"
                             min="10"
                             step="5"
                             value="<%= settings.email?.pingLatencyThreshold || 50 %>"
                             class="flex-1 bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500 text-center">
                      <span class="flex items-center text-gray-400 font-medium">ms</span>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Action Buttons -->
              <div class="bg-gradient-to-br from-slate-800 to-slate-900 rounded-xl border border-slate-700/50 p-6 shadow-xl hover:shadow-2xl transition-all duration-300">
                <h3 class="text-lg font-bold text-white flex items-center gap-2 mb-6">
                  <div class="w-6 h-6 bg-gradient-to-br from-purple-500 to-purple-600 rounded-lg flex items-center justify-center shadow-lg">
                    <i class="fas fa-play text-white text-sm"></i>
                  </div>
                  Actions
                </h3>

                <div class="space-y-4">
                  <button id="save-email-btn" class="w-full px-4 py-3 bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white rounded-xl transition-all duration-300 font-medium text-sm hover:shadow-lg hover:shadow-green-500/25 hover:scale-105 flex items-center justify-center gap-2">
                    <i class="fas fa-save"></i>
                    <span>Save Email Settings</span>
                  </button>
                  <button id="test-email-btn" class="w-full px-4 py-3 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white rounded-xl transition-all duration-300 font-medium text-sm hover:shadow-lg hover:shadow-blue-500/25 hover:scale-105 flex items-center justify-center gap-2">
                    <i class="fas fa-paper-plane"></i>
                    <span>Test Email</span>
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Flapping Detection Section -->
          <div class="space-y-6">
            <div class="flex items-center gap-3">
              <div class="w-8 h-8 bg-gradient-to-br from-orange-500 to-orange-600 rounded-lg flex items-center justify-center shadow-lg">
                <i class="fas fa-exclamation-triangle text-white text-sm"></i>
              </div>
              <h2 class="text-xl font-bold text-white">Flapping Detection</h2>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
              <!-- Flapping Configuration -->
              <div class="bg-gradient-to-br from-slate-800 to-slate-900 rounded-xl border border-slate-700/50 p-6 shadow-xl hover:shadow-2xl transition-all duration-300">
                <h3 class="text-lg font-bold text-white flex items-center gap-2 mb-6">
                  <div class="w-6 h-6 bg-gradient-to-br from-red-500 to-red-600 rounded-lg flex items-center justify-center shadow-lg">
                    <i class="fas fa-cog text-white text-sm"></i>
                  </div>
                  Detection Settings
                </h3>

                <div class="space-y-4">
                  <!-- Enable Flapping Detection -->
                  <div class="bg-slate-700/30 rounded-lg p-4">
                    <div class="flex items-center justify-between">
                      <div class="flex items-center gap-3">
                        <i class="fas fa-toggle-on text-blue-400"></i>
                        <div>
                          <p class="text-sm font-medium text-white">Enable Flapping Detection</p>
                          <p class="text-xs text-gray-400">Detect and handle unstable devices/targets</p>
                        </div>
                      </div>
                      <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="flapping-enabled" class="sr-only peer" <%= settings.flapping?.enabled ? 'checked' : '' %>>
                        <div class="w-11 h-6 bg-slate-600 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-500 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                      </label>
                    </div>
                  </div>

                  <!-- Device Flapping Thresholds -->
                  <div class="bg-slate-700/30 rounded-lg p-4">
                    <h4 class="text-sm font-medium text-gray-300 mb-3 flex items-center gap-2">
                      <i class="fas fa-server text-blue-400 text-xs"></i>
                      Device Flapping
                    </h4>
                    <div class="grid grid-cols-2 gap-4">
                      <div>
                        <label class="block text-xs font-medium text-gray-400 mb-1">Transitions</label>
                        <input type="number"
                               id="flapping-device-threshold"
                               min="2"
                               max="20"
                               value="<%= settings.flapping?.deviceThreshold || 5 %>"
                               class="w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500 text-center text-sm">
                      </div>
                      <div>
                        <label class="block text-xs font-medium text-gray-400 mb-1">Window (min)</label>
                        <input type="number"
                               id="flapping-device-window"
                               min="1"
                               max="60"
                               value="<%= settings.flapping?.deviceWindowMinutes || 10 %>"
                               class="w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500 text-center text-sm">
                      </div>
                    </div>
                    <p class="text-xs text-gray-500 mt-2">Alert if device changes state more than threshold times within window</p>
                  </div>

                  <!-- Ping Flapping Thresholds -->
                  <div class="bg-slate-700/30 rounded-lg p-4">
                    <h4 class="text-sm font-medium text-gray-300 mb-3 flex items-center gap-2">
                      <i class="fas fa-network-wired text-green-400 text-xs"></i>
                      Ping Flapping
                    </h4>
                    <div class="grid grid-cols-2 gap-4">
                      <div>
                        <label class="block text-xs font-medium text-gray-400 mb-1">Transitions</label>
                        <input type="number"
                               id="flapping-ping-threshold"
                               min="2"
                               max="20"
                               value="<%= settings.flapping?.pingThreshold || 3 %>"
                               class="w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500 text-center text-sm">
                      </div>
                      <div>
                        <label class="block text-xs font-medium text-gray-400 mb-1">Window (min)</label>
                        <input type="number"
                               id="flapping-ping-window"
                               min="1"
                               max="60"
                               value="<%= settings.flapping?.pingWindowMinutes || 5 %>"
                               class="w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500 text-center text-sm">
                      </div>
                    </div>
                    <p class="text-xs text-gray-500 mt-2">Alert if ping target changes state more than threshold times within window</p>
                  </div>
                </div>
              </div>

              <!-- Flapping Actions -->
              <div class="bg-gradient-to-br from-slate-800 to-slate-900 rounded-xl border border-slate-700/50 p-6 shadow-xl hover:shadow-2xl transition-all duration-300">
                <h3 class="text-lg font-bold text-white flex items-center gap-2 mb-6">
                  <div class="w-6 h-6 bg-gradient-to-br from-yellow-500 to-yellow-600 rounded-lg flex items-center justify-center shadow-lg">
                    <i class="fas fa-bell text-white text-sm"></i>
                  </div>
                  Notification Actions
                </h3>

                <div class="space-y-4">
                  <!-- Suppress Notifications -->
                  <div class="bg-slate-700/30 rounded-lg p-4">
                    <div class="flex items-center justify-between">
                      <div class="flex items-center gap-3">
                        <i class="fas fa-volume-mute text-orange-400"></i>
                        <div>
                          <p class="text-sm font-medium text-white">Suppress Notifications</p>
                          <p class="text-xs text-gray-400">Stop alerts when flapping is detected</p>
                        </div>
                      </div>
                      <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="flapping-suppress-notifications" class="sr-only peer" <%= settings.flapping?.suppressNotifications ? 'checked' : '' %>>
                        <div class="w-11 h-6 bg-slate-600 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-500 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                      </label>
                    </div>
                  </div>

                  <!-- Flapping Start Alerts -->
                  <div class="bg-slate-700/30 rounded-lg p-4">
                    <div class="flex items-center justify-between">
                      <div class="flex items-center gap-3">
                        <i class="fas fa-exclamation-triangle text-red-400"></i>
                        <div>
                          <p class="text-sm font-medium text-white">Alert on Flapping Start</p>
                          <p class="text-xs text-gray-400">Notify when flapping begins</p>
                        </div>
                      </div>
                      <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="flapping-notify-start" class="sr-only peer" <%= settings.flapping?.notifyOnFlappingStart ? 'checked' : '' %>>
                        <div class="w-11 h-6 bg-slate-600 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-500 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                      </label>
                    </div>
                  </div>

                  <!-- Flapping Stop Alerts -->
                  <div class="bg-slate-700/30 rounded-lg p-4">
                    <div class="flex items-center justify-between">
                      <div class="flex items-center gap-3">
                        <i class="fas fa-check-circle text-green-400"></i>
                        <div>
                          <p class="text-sm font-medium text-white">Alert on Flapping Stop</p>
                          <p class="text-xs text-gray-400">Notify when flapping ends</p>
                        </div>
                      </div>
                      <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="flapping-notify-stop" class="sr-only peer" <%= settings.flapping?.notifyOnFlappingStop ? 'checked' : '' %>>
                        <div class="w-11 h-6 bg-slate-600 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-500 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                      </label>
                    </div>
                  </div>

                  <!-- Action Buttons -->
                  <div class="flex gap-3 pt-2">
                    <button id="save-flapping-btn" class="flex-1 px-4 py-3 bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white rounded-xl transition-all duration-300 font-medium text-sm hover:shadow-lg hover:shadow-green-500/25 hover:scale-105 flex items-center justify-center gap-2">
                      <i class="fas fa-save"></i>
                      <span>Save Settings</span>
                    </button>
                    <button id="view-flapping-status-btn" class="px-4 py-3 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white rounded-xl transition-all duration-300 font-medium text-sm hover:shadow-lg hover:shadow-blue-500/25 hover:scale-105 flex items-center justify-center gap-2">
                      <i class="fas fa-eye"></i>
                      <span>View Status</span>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- System Information Section -->
          <div class="space-y-6">
            <div class="flex items-center gap-3">
              <div class="w-8 h-8 bg-gradient-to-br from-purple-500 to-purple-600 rounded-lg flex items-center justify-center shadow-lg">
                <i class="fas fa-info-circle text-white text-sm"></i>
              </div>
              <h2 class="text-xl font-bold text-white">System Information</h2>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
              <!-- System Status -->
              <div class="bg-gradient-to-br from-slate-800 to-slate-900 rounded-xl border border-slate-700/50 p-6 shadow-xl hover:shadow-2xl transition-all duration-300">
                <h3 class="text-lg font-bold text-white flex items-center gap-2 mb-4">
                  <div class="w-6 h-6 bg-gradient-to-br from-green-500 to-green-600 rounded-lg flex items-center justify-center shadow-lg">
                    <i class="fas fa-heartbeat text-white text-sm"></i>
                  </div>
                  System Status
                </h3>

                <div class="space-y-3">
                  <div class="flex items-center justify-between">
                    <span class="text-gray-400">SNMP Monitoring</span>
                    <div class="flex items-center gap-2">
                      <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                      <span class="text-green-400 text-sm font-medium">Active</span>
                    </div>
                  </div>
                  <div class="flex items-center justify-between">
                    <span class="text-gray-400">Ping Monitoring</span>
          <a href="/websites" class="flex items-center gap-3 px-4 py-3 rounded-lg text-gray-300 hover:bg-slate-700 transition-all duration-200">
            <i class="fas fa-globe w-5"></i>
            <span>Website Monitor</span>
          </a>
                    <div class="flex items-center gap-2">
                      <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                      <span class="text-green-400 text-sm font-medium">Active</span>
                    </div>
                  </div>
                  <div class="flex items-center justify-between">
                    <span class="text-gray-400">Database</span>
                    <div class="flex items-center gap-2">
                      <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                      <span class="text-green-400 text-sm font-medium">Connected</span>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Performance Metrics -->
              <div class="bg-gradient-to-br from-slate-800 to-slate-900 rounded-xl border border-slate-700/50 p-6 shadow-xl hover:shadow-2xl transition-all duration-300">
                <h3 class="text-lg font-bold text-white flex items-center gap-2 mb-4">
                  <div class="w-6 h-6 bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg flex items-center justify-center shadow-lg">
                    <i class="fas fa-chart-line text-white text-sm"></i>
                  </div>
                  Performance
                </h3>

                <div class="space-y-3">
                  <div class="flex items-center justify-between">
                    <span class="text-gray-400">SNMP Interval</span>
                    <span class="text-blue-400 font-medium"><%= (settings.pollingInterval / 1000) %>s</span>
                  </div>
                  <div class="flex items-center justify-between">
                    <span class="text-gray-400">Ping Interval</span>
                    <span class="text-blue-400 font-medium"><%= (settings.pingInterval / 1000) %>s</span>
                  </div>
                  <div class="flex items-center justify-between">
                    <span class="text-gray-400">Data Retention</span>
                    <span class="text-blue-400 font-medium"><%= settings.dataRetention || 730 %> days</span>
                  </div>
                </div>
              </div>

              <!-- Quick Actions -->
              <div class="bg-gradient-to-br from-slate-800 to-slate-900 rounded-xl border border-slate-700/50 p-6 shadow-xl hover:shadow-2xl transition-all duration-300">
                <h3 class="text-lg font-bold text-white flex items-center gap-2 mb-4">
                  <div class="w-6 h-6 bg-gradient-to-br from-yellow-500 to-yellow-600 rounded-lg flex items-center justify-center shadow-lg">
                    <i class="fas fa-bolt text-white text-sm"></i>
                  </div>
                  Quick Actions
                </h3>

                <div class="space-y-3">
                  <a href="/" class="w-full flex items-center gap-3 px-4 py-3 bg-gradient-to-r from-slate-700 to-slate-800 hover:from-slate-600 hover:to-slate-700 rounded-xl transition-all duration-300 hover:shadow-lg hover:scale-105 group">
                    <i class="fas fa-chart-area text-blue-400 group-hover:scale-110 transition-transform duration-200"></i>
                    <span class="text-white font-medium">View Dashboard</span>
                  </a>
                  <a href="/monitoring" class="w-full flex items-center gap-3 px-4 py-3 bg-gradient-to-r from-slate-700 to-slate-800 hover:from-slate-600 hover:to-slate-700 rounded-xl transition-all duration-300 hover:shadow-lg hover:scale-105 group">
                    <i class="fas fa-gauge-high text-green-400 group-hover:scale-110 transition-transform duration-200"></i>
                    <span class="text-white font-medium">Bandwidth Monitor</span>
                  </a>
                  <a href="/ping" class="w-full flex items-center gap-3 px-4 py-3 bg-gradient-to-r from-slate-700 to-slate-800 hover:from-slate-600 hover:to-slate-700 rounded-xl transition-all duration-300 hover:shadow-lg hover:scale-105 group">
                    <i class="fas fa-network-wired text-purple-400 group-hover:scale-110 transition-transform duration-200"></i>
                    <span class="text-white font-medium">Ping Monitor</span>
          <a href="/websites" class="flex items-center gap-3 px-4 py-3 rounded-lg text-gray-300 hover:bg-slate-700 transition-all duration-200">
            <i class="fas fa-globe w-5"></i>
            <span>Website Monitor</span>
          </a>
                  </a>
                  <a href="/devices" class="w-full flex items-center gap-3 px-4 py-3 bg-gradient-to-r from-slate-700 to-slate-800 hover:from-slate-600 hover:to-slate-700 rounded-xl transition-all duration-300 hover:shadow-lg hover:scale-105 group">
                    <i class="fas fa-server text-orange-400 group-hover:scale-110 transition-transform duration-200"></i>
                    <span class="text-white font-medium">Device Manager</span>
                  </a>
                </div>
              </div>
            </div>
          </div>

          <!-- Interface Selection for Graphing -->
          <div class="bg-gradient-to-br from-slate-800 to-slate-900 rounded-xl border border-slate-700/50 p-6 shadow-xl hover:shadow-2xl transition-all duration-300">
            <h3 class="text-lg font-bold text-white flex items-center gap-2 mb-6">
              <div class="w-8 h-8 bg-gradient-to-br from-green-500 to-green-600 rounded-lg flex items-center justify-center shadow-lg">
                <i class="fas fa-chart-line text-white text-sm"></i>
              </div>
              Interface Selection for Graphing
            </h3>

            <div class="space-y-4">
              <% Object.values(devices).forEach(device => { %>
                <div class="bg-slate-700/50 rounded-lg p-4">
                  <div class="flex items-center justify-between mb-3">
                    <h5 class="font-semibold text-white flex items-center gap-2">
                      <i class="fas fa-server text-blue-400"></i>
                      <%= device.name %>
                    </h5>
                    <span class="text-xs bg-blue-600 text-white px-2 py-1 rounded">
                      <%= device.selectedInterfaces ? device.selectedInterfaces.length : 0 %> selected
                    </span>
                  </div>

                  <% if (device.selectedInterfaces && device.selectedInterfaces.length > 0) { %>
                    <div class="flex flex-wrap gap-2">
                      <% device.selectedInterfaces.forEach(iface => { %>
                        <%- typeof iface === 'string' ? `
                          <label class="flex items-center gap-2 bg-slate-600 hover:bg-slate-500 rounded-lg px-3 py-2 cursor-pointer transition-all">
                            <input type="checkbox"
                                   name="interface-${device.id}"
                                   value="${iface}"
                                   data-device="${device.id}"
                                   class="interface-checkbox rounded"
                                   checked>
                            <span class="text-sm text-gray-200">${iface}</span>
                          </label>
                        ` : `
                          <label class="flex items-center gap-2 bg-slate-600 hover:bg-slate-500 rounded-lg px-3 py-2 cursor-pointer transition-all">
                            <input type="checkbox"
                                   name="interface-${device.id}"
                                   value="${iface.name}"
                                   data-device="${device.id}"
                                   class="interface-checkbox rounded"
                                   checked>
                            <span class="text-sm text-gray-200">${iface.name}</span>
                          </label>
                        ` %>
                      <% }); %>
                    </div>
                    <p class="text-xs text-gray-400 mt-2">Check interfaces to include in graph monitoring</p>
                  <% } else { %>
                    <p class="text-xs text-gray-500">No interfaces selected for this device</p>
                  <% } %>
                </div>
              <% }); %>
            </div>

            <!-- Save Interface Selection Button -->
            <div class="mt-4">
              <button id="save-interfaces-btn" class="px-6 py-2 bg-gradient-to-r from-green-600 to-green-700 text-white rounded-lg hover:from-green-500 hover:to-green-600 transition-all font-medium">
                <i class="fas fa-save mr-2"></i>Save Interface Selection
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast Notifications -->
  <div id="toast-container" class="fixed top-4 right-4 z-50 space-y-2"></div>

  <script>
    // Initialize sliders with current values
    document.addEventListener('DOMContentLoaded', function() {
      // Set initial slider values
      const pollingIntervalSlider = document.getElementById('polling-interval-slider');
      const pingIntervalSlider = document.getElementById('ping-interval-slider');

      if (pollingIntervalSlider) {
        updateSliderValue('polling-interval-slider', pollingIntervalSlider.value);
      }
      if (pingIntervalSlider) {
        updateSliderValue('ping-interval-slider', pingIntervalSlider.value);
      }

      // Add event listeners for sliders
      document.querySelectorAll('.slider').forEach(slider => {
        slider.addEventListener('input', function() {
          updateSliderValue(this.id, this.value);
        });
      });

      // Initialize mobile menu
      const mobileMenuButton = document.getElementById('mobile-menu-button');
      const sidebar = document.getElementById('sidebar');
      const mobileOverlay = document.getElementById('mobile-overlay');

      if (mobileMenuButton && sidebar && mobileOverlay) {
        mobileMenuButton.addEventListener('click', function() {
          sidebar.classList.toggle('-translate-x-full');
          mobileOverlay.classList.toggle('hidden');
        });

        mobileOverlay.addEventListener('click', function() {
          sidebar.classList.add('-translate-x-full');
          mobileOverlay.classList.add('hidden');
        });
      }

      // Initialize header stats
      updateHeaderStats();
      setInterval(updateHeaderStats, 10000);
    });

    function updateSliderValue(sliderId, value) {
      let displayElement;
      let unit = '';

      switch(sliderId) {
        case 'polling-interval-slider':
          displayElement = document.getElementById('polling-current-value');
          unit = 's';
          break;
        case 'ping-interval-slider':
          displayElement = document.getElementById('ping-current-value');
          unit = 's';
          break;
        case 'retention-slider':
          displayElement = document.getElementById('retention-current-value');
          unit = ' days';
          break;
      }

      if (displayElement) {
        displayElement.textContent = value + unit;
      }
    }

    // Enhanced notification system
    function showNotification(message, type = 'info', duration = 3000) {
      const toastContainer = document.getElementById('toast-container');
      if (!toastContainer) return;

      const toast = document.createElement('div');
      toast.className = `flex items-center p-4 rounded-lg shadow-lg transform transition-all duration-300 translate-x-full max-w-sm z-50`;

      let iconClass = '';
      let bgColor = '';

      switch(type) {
        case 'success':
          iconClass = 'fas fa-check-circle';
          bgColor = 'bg-green-500';
          break;
        case 'error':
          iconClass = 'fas fa-exclamation-circle';
          bgColor = 'bg-red-500';
          break;
        case 'warning':
          iconClass = 'fas fa-exclamation-triangle';
          bgColor = 'bg-yellow-500';
          break;
        default:
          iconClass = 'fas fa-info-circle';
          bgColor = 'bg-blue-500';
      }

      toast.classList.add(bgColor, 'text-white');

      toast.innerHTML = `
        <i class="${iconClass} mr-3"></i>
        <span class="flex-1">${message}</span>
        <button onclick="this.parentElement.remove()" class="ml-3 hover:opacity-75">
          <i class="fas fa-times"></i>
        </button>
      `;

      toastContainer.appendChild(toast);

      // Animate in
      setTimeout(() => {
        toast.classList.remove('translate-x-full');
      }, 10);

      // Auto remove
      setTimeout(() => {
        toast.classList.add('translate-x-full');
        setTimeout(() => {
          if (toast.parentElement) {
            toast.remove();
          }
        }, 300);
      }, duration);
    }

    // Update header system stats
    function updateHeaderStats() {
      fetch('/api/system-info')
        .then(response => response.json())
        .then(data => {
          if (document.getElementById('header-cpu')) {
            document.getElementById('header-cpu').textContent = data.cpuUsage + '%';
          }
          if (document.getElementById('header-memory')) {
            const memUsedGB = (data.memory.used / 1024 / 1024 / 1024).toFixed(1);
            const memTotalGB = (data.memory.total / 1024 / 1024 / 1024).toFixed(1);
            document.getElementById('header-memory').textContent = `${memUsedGB}/${memTotalGB}GB`;
          }
          if (document.getElementById('header-storage') && data.storage) {
            const storageUsedGB = (data.storage.used / 1024 / 1024 / 1024).toFixed(1);
            const storageTotalGB = (data.storage.total / 1024 / 1024 / 1024).toFixed(1);
            document.getElementById('header-storage').textContent = `${storageUsedGB}/${storageTotalGB}GB`;
          }
        })
        .catch(err => console.error('Error fetching system info:', err));
    }

    // Element references
    const pollingIntervalSlider = document.getElementById('polling-interval-slider');
    const pingIntervalSlider = document.getElementById('ping-interval-slider');
    const retentionSlider = document.getElementById('retention-slider');
    const saveGeneralBtn = document.getElementById('save-general-btn');
    const saveInterfacesBtn = document.getElementById('save-interfaces-btn');
    const statusMessage = document.getElementById('status-message');
    const interfaceCheckboxes = document.querySelectorAll('.interface-checkbox');

    // InfluxDB elements
    const influxdbUrl = document.getElementById('influxdb-url');
    const influxdbOrg = document.getElementById('influxdb-org');
    const influxdbBucket = document.getElementById('influxdb-bucket');
    const influxdbToken = document.getElementById('influxdb-token');
    const testInfluxdbBtn = document.getElementById('test-influxdb-btn');
    const saveInfluxdbBtn = document.getElementById('save-influxdb-btn');
    const influxdbStatus = document.getElementById('influxdb-status');
    const influxdbStatusText = document.getElementById('influxdb-status-text');
    const toggleTokenVisibility = document.getElementById('toggle-token-visibility');
    const tokenEyeIcon = document.getElementById('token-eye-icon');

    // Telegram elements
    const saveTelegramBtn = document.getElementById('save-telegram-btn');
    const testTelegramBtn = document.getElementById('test-telegram-btn');

    // Email elements
    const saveEmailBtn = document.getElementById('save-email-btn');
    const testEmailBtn = document.getElementById('test-email-btn');

    // Flapping elements
    const saveFlappingBtn = document.getElementById('save-flapping-btn');
    const viewFlappingStatusBtn = document.getElementById('view-flapping-status-btn');

    // Ping elements
    const savePingNotificationsBtn = document.getElementById('save-ping-notifications-btn');

    // Toggle token visibility
    if (toggleTokenVisibility && tokenEyeIcon) {
      toggleTokenVisibility.addEventListener('click', function() {
        if (influxdbToken.type === 'password') {
          influxdbToken.type = 'text';
          tokenEyeIcon.classList.remove('fa-eye');
          tokenEyeIcon.classList.add('fa-eye-slash');
        } else {
          influxdbToken.type = 'password';
          tokenEyeIcon.classList.remove('fa-eye-slash');
          tokenEyeIcon.classList.add('fa-eye');
        }
      });
    }

    // Test InfluxDB connection
    if (testInfluxdbBtn) {
      testInfluxdbBtn.addEventListener('click', async function() {
        const url = influxdbUrl.value.trim();
        const org = influxdbOrg.value.trim();
        const bucket = influxdbBucket.value.trim();
        const token = influxdbToken.value.trim();

        if (!url || !org || !bucket || !token) {
          showNotification('Please fill in all fields', 'error');
          return;
        }

        testInfluxdbBtn.disabled = true;
        testInfluxdbBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Testing...';

        try {
          const response = await fetch('/api/settings/influxdb/test', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ url, org, bucket, token })
          });

          const data = await response.json();

          if (response.ok && data.success) {
            showNotification(' Connection successful!', 'success');
          } else {
            showNotification(' Connection failed: ' + (data.error || 'Unknown error'), 'error');
          }
        } catch (err) {
          console.error('Error:', err);
          showNotification(' Connection test failed', 'error');
        } finally {
          testInfluxdbBtn.disabled = false;
          testInfluxdbBtn.innerHTML = '<i class="fas fa-plug mr-2"></i>Test Connection';
        }
      });
    }

    // Save InfluxDB settings
    if (saveInfluxdbBtn) {
      saveInfluxdbBtn.addEventListener('click', async function() {
        const url = influxdbUrl.value.trim();
        const org = influxdbOrg.value.trim();
        const bucket = influxdbBucket.value.trim();
        const token = influxdbToken.value.trim();

        if (!url || !org || !bucket || !token) {
          showNotification('Please fill in all fields', 'error');
          return;
        }

        saveInfluxdbBtn.disabled = true;
        saveInfluxdbBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Saving...';

        try {
          const response = await fetch('/api/settings/influxdb', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ url, org, bucket, token })
          });

          const data = await response.json();

          if (response.ok && data.success) {
            showNotification(' Settings saved successfully. Restarting...', 'success');
            setTimeout(() => {
              location.reload();
            }, 2000);
          } else {
            showNotification(' Failed to save: ' + (data.error || 'Unknown error'), 'error');
          }
        } catch (err) {
          console.error('Error:', err);
          showNotification(' Failed to save settings', 'error');
        } finally {
          saveInfluxdbBtn.disabled = false;
          saveInfluxdbBtn.innerHTML = '<i class="fas fa-save mr-2"></i>Save Settings';
        }
      });
    }

    // Save general monitoring settings
    if (saveGeneralBtn) {
      saveGeneralBtn.addEventListener('click', async function() {
        const pollingInterval = parseInt(pollingIntervalSlider.value) * 1000;
        const pingInterval = parseInt(pingIntervalSlider.value) * 1000;
        const dataRetention = parseInt(retentionSlider.value);

        saveGeneralBtn.disabled = true;
        saveGeneralBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Saving...';

        try {
          const response = await fetch('/api/settings', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              pollingIntervalSeconds: pollingInterval / 1000,
              pingIntervalSeconds: pingInterval / 1000,
              dataRetentionDays: dataRetention
            })
          });

          if (!response.ok) {
            throw new Error('Failed to update settings');
          }

          const data = await response.json();
          showNotification(' Monitoring settings saved successfully', 'success');

          setTimeout(() => {
            location.reload();
          }, 2000);
        } catch (err) {
          console.error('Error:', err);
          showNotification(' Failed to save monitoring settings', 'error');
        } finally {
          saveGeneralBtn.disabled = false;
          saveGeneralBtn.innerHTML = '<i class="fas fa-save mr-2"></i>Save Monitoring Settings';
        }
      });
    }

    // Save ping notifications
    if (savePingNotificationsBtn) {
      savePingNotificationsBtn.addEventListener('click', async function() {
        const enabled = document.getElementById('ping-notifications-enabled').checked;
        const notifyOnDown = document.getElementById('ping-notify-down').checked;
        const notifyOnTimeout = document.getElementById('ping-notify-timeout').checked;
        const notifyOnHighLatency = document.getElementById('ping-notify-high-latency').checked;
        const latencyThreshold = parseInt(document.getElementById('ping-latency-threshold').value);

        if (!latencyThreshold || latencyThreshold < 10 || latencyThreshold > 500) {
          showNotification('Latency threshold must be between 10 and 500 ms', 'warning');
          return;
        }

        savePingNotificationsBtn.disabled = true;
        savePingNotificationsBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Saving...';

        try {
          const response = await fetch('/api/settings/ping-notifications', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              enabled,
              notifyOnDown,
              notifyOnTimeout,
              notifyOnHighLatency,
              latencyThreshold
            })
          });

          if (!response.ok) {
            throw new Error('Failed to update notification settings');
          }

          showNotification(' Notification settings saved successfully', 'success');

          setTimeout(() => {
            location.reload();
          }, 1500);
        } catch (err) {
          console.error('Error:', err);
          showNotification(' Failed to save notification settings', 'error');
        } finally {
          savePingNotificationsBtn.disabled = false;
          savePingNotificationsBtn.innerHTML = '<i class="fas fa-check mr-2"></i>Save Ping Settings';
        }
      });
    }

    // Save website settings
    const saveWebsiteSettingsBtn = document.getElementById('save-website-settings-btn');
    if (saveWebsiteSettingsBtn) {
      saveWebsiteSettingsBtn.addEventListener('click', async function() {
        const enabled = document.getElementById('website-enabled').checked;
        const interval = parseInt(document.getElementById('website-interval').value);
        const timeout = parseInt(document.getElementById('website-timeout').value);
        const notifyOnDown = document.getElementById('website-notify-down').checked;
        const notifyOnUp = document.getElementById('website-notify-up').checked;
        const notifyOnSslExpiry = document.getElementById('website-notify-ssl-expiry').checked;
        const sslExpiryWarningDays = parseInt(document.getElementById('website-ssl-expiry-days').value);

        if (interval < 30000) {
          showNotification('Monitoring interval must be at least 30 seconds', 'warning');
          return;
        }

        if (timeout < 1000) {
          showNotification('Request timeout must be at least 1 second', 'warning');
          return;
        }

        if (sslExpiryWarningDays < 1 || sslExpiryWarningDays > 90) {
          showNotification('SSL expiry warning must be between 1 and 90 days', 'warning');
          return;
        }

        saveWebsiteSettingsBtn.disabled = true;
        saveWebsiteSettingsBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Saving...';

        try {
          const response = await fetch('/api/settings/website', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              enabled,
              interval,
              timeout,
              notifyOnDown,
              notifyOnUp,
              notifyOnSslExpiry,
              sslExpiryWarningDays
            })
          });

          if (!response.ok) {
            throw new Error('Failed to update website settings');
          }

          showNotification(' Website settings saved successfully', 'success');

          setTimeout(() => {
            location.reload();
          }, 1500);
        } catch (err) {
          console.error('Error:', err);
          showNotification(' Failed to save website settings', 'error');
        } finally {
          saveWebsiteSettingsBtn.disabled = false;
          saveWebsiteSettingsBtn.innerHTML = '<i class="fas fa-check mr-2"></i>Save Website Settings';
        }
      });
    }

    // Save interface selection
    if (saveInterfacesBtn) {
      saveInterfacesBtn.addEventListener('click', async function() {
        const selectedByDevice = {};

        // Group checked interfaces by device
        interfaceCheckboxes.forEach(checkbox => {
          const deviceId = checkbox.getAttribute('data-device');
          if (!selectedByDevice[deviceId]) {
            selectedByDevice[deviceId] = [];
          }
          if (checkbox.checked) {
            selectedByDevice[deviceId].push(checkbox.value);
          }
        });

        // Check if at least one interface is selected
        const totalSelected = Object.values(selectedByDevice).reduce((sum, arr) => sum + arr.length, 0);
        if (totalSelected === 0) {
          showNotification('Error: Please select at least one interface', 'error');
          return;
        }

        saveInterfacesBtn.disabled = true;
        saveInterfacesBtn.classList.add('opacity-50');

        try {
          // Save each device's interface selection
          const promises = Object.entries(selectedByDevice).map(([deviceId, interfaces]) =>
            fetch(`/api/devices/${deviceId}/select-interfaces`, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ selectedInterfaces: interfaces })
            })
          );

          const responses = await Promise.all(promises);
          const allSuccess = responses.every(r => r.ok);

          if (!allSuccess) {
            throw new Error('Some updates failed');
          }

          showNotification(` Interface selection updated! ${totalSelected} interfaces selected for graphing`, 'success');

          // Refresh after 2 seconds
          setTimeout(() => {
            location.reload();
          }, 2000);
        } catch (err) {
          console.error('Error:', err);
          showNotification(' Failed to save interface selection', 'error');
        } finally {
          saveInterfacesBtn.disabled = false;
          saveInterfacesBtn.classList.remove('opacity-50');
        }
      });
    }

    // Save Telegram settings
    if (saveTelegramBtn) {
      saveTelegramBtn.addEventListener('click', async function() {
        const telegramSettings = {
          enabled: document.getElementById('telegram-enabled').checked,
          botToken: document.getElementById('telegram-bot-token').value.trim(),
          chatId: document.getElementById('telegram-chat-id').value.trim(),
          notifyOnDeviceDown: document.getElementById('telegram-notify-device-down').checked,
          notifyOnDeviceUp: document.getElementById('telegram-notify-device-up').checked,
          notifyOnHighCpu: document.getElementById('telegram-notify-high-cpu').checked,
          cpuThreshold: parseInt(document.getElementById('telegram-cpu-threshold').value) || 80,
          notifyOnPingDown: document.getElementById('telegram-notify-ping-down').checked,
          notifyOnPingUp: document.getElementById('telegram-notify-ping-up').checked,
          notifyOnPingTimeout: document.getElementById('telegram-notify-ping-timeout').checked,
          notifyOnPingHighLatency: document.getElementById('telegram-notify-ping-high-latency').checked,
          pingLatencyThreshold: parseInt(document.getElementById('telegram-ping-latency-threshold').value) || 50
        };

        // Validation
        if (telegramSettings.enabled) {
          if (!telegramSettings.botToken) {
            showNotification('Error: Bot token is required when Telegram is enabled', 'error');
            return;
          }
          if (!telegramSettings.chatId) {
            showNotification('Error: Chat ID is required when Telegram is enabled', 'error');
            return;
          }
          if (telegramSettings.cpuThreshold < 1 || telegramSettings.cpuThreshold > 100) {
            showNotification('Error: CPU threshold must be between 1 and 100', 'error');
            return;
          }
          if (telegramSettings.pingLatencyThreshold < 10 || telegramSettings.pingLatencyThreshold > 500) {
            showNotification('Error: Ping latency threshold must be between 10 and 500 ms', 'error');
            return;
          }
        }

        saveTelegramBtn.disabled = true;
        saveTelegramBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Saving...';

        try {
          const response = await fetch('/api/settings/telegram', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(telegramSettings)
          });

          if (!response.ok) {
            throw new Error('Failed to update Telegram settings');
          }

          const data = await response.json();
          showNotification(' Telegram settings saved successfully', 'success');

          // Refresh settings after 2 seconds
          setTimeout(() => {
            location.reload();
          }, 2000);
        } catch (err) {
          console.error('Error:', err);
          showNotification(' Failed to save Telegram settings', 'error');
        } finally {
          saveTelegramBtn.disabled = false;
          saveTelegramBtn.innerHTML = '<i class="fas fa-check mr-2"></i>Save Settings';
        }
      });
    }

    // Test Telegram connection
    if (testTelegramBtn) {
      testTelegramBtn.addEventListener('click', async function() {
        const botToken = document.getElementById('telegram-bot-token').value.trim();
        const chatId = document.getElementById('telegram-chat-id').value.trim();

        if (!botToken || !chatId) {
          showNotification('Error: Bot token and Chat ID are required for testing', 'error');
          return;
        }

        testTelegramBtn.disabled = true;
        testTelegramBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Testing...';

        try {
          const response = await fetch('/api/settings/telegram/test', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ botToken, chatId })
          });

          if (!response.ok) {
            throw new Error('Failed to test Telegram connection');
          }

          const data = await response.json();
          if (data.success) {
            showNotification(' Telegram test message sent successfully!', 'success');
          } else {
            showNotification(' Telegram test failed: ' + data.message, 'error');
          }
        } catch (err) {
          console.error('Error:', err);
          showNotification(' Failed to test Telegram connection', 'error');
        } finally {
          testTelegramBtn.disabled = false;
          testTelegramBtn.innerHTML = '<i class="fas fa-paper-plane mr-2"></i>Test';
        }
      });
    }

    // Save Email settings
    if (saveEmailBtn) {
      saveEmailBtn.addEventListener('click', async function() {
        const emailSettings = {
          smtp: {
            host: document.getElementById('email-smtp-host').value.trim(),
            port: parseInt(document.getElementById('email-smtp-port').value) || 587,
            secure: document.getElementById('email-smtp-secure').value === 'true',
            user: document.getElementById('email-smtp-user').value.trim(),
            pass: document.getElementById('email-smtp-pass').value.trim()
          },
          from: document.getElementById('email-from').value.trim(),
          to: document.getElementById('email-to').value.trim(),
          notifyOnDeviceDown: document.getElementById('email-notify-device-down').checked,
          notifyOnDeviceUp: document.getElementById('email-notify-device-up').checked,
          notifyOnHighCpu: document.getElementById('email-notify-high-cpu').checked,
          cpuThreshold: parseInt(document.getElementById('email-cpu-threshold').value) || 80,
          notifyOnPingDown: document.getElementById('email-notify-ping-down').checked,
          notifyOnPingUp: document.getElementById('email-notify-ping-up').checked,
          notifyOnPingTimeout: document.getElementById('email-notify-ping-timeout').checked,
          notifyOnPingHighLatency: document.getElementById('email-notify-ping-high-latency').checked,
          pingLatencyThreshold: parseInt(document.getElementById('email-ping-latency-threshold').value) || 50
        };

        // Validation
        if (emailSettings.smtp.host && emailSettings.from && emailSettings.to) {
          if (!emailSettings.smtp.user || !emailSettings.smtp.pass) {
            showNotification('Error: SMTP username and password are required when SMTP host is configured', 'error');
            return;
          }
          if (emailSettings.cpuThreshold < 1 || emailSettings.cpuThreshold > 100) {
            showNotification('Error: CPU threshold must be between 1 and 100', 'error');
            return;
          }
          if (emailSettings.pingLatencyThreshold < 10 || emailSettings.pingLatencyThreshold > 500) {
            showNotification('Error: Ping latency threshold must be between 10 and 500 ms', 'error');
            return;
          }
        }

        saveEmailBtn.disabled = true;
        saveEmailBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Saving...';

        try {
          const response = await fetch('/api/settings/email', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(emailSettings)
          });

          if (!response.ok) {
            throw new Error('Failed to update Email settings');
          }

          const data = await response.json();
          showNotification(' Email settings saved successfully', 'success');

          // Refresh settings after 2 seconds
          setTimeout(() => {
            location.reload();
          }, 2000);
        } catch (err) {
          console.error('Error:', err);
          showNotification(' Failed to save Email settings', 'error');
        } finally {
          saveEmailBtn.disabled = false;
          saveEmailBtn.innerHTML = '<i class="fas fa-save mr-2"></i>Save Email Settings';
        }
      });
    }

    // Test Email connection
    if (testEmailBtn) {
      testEmailBtn.addEventListener('click', async function() {
        const emailSettings = {
          smtp: {
            host: document.getElementById('email-smtp-host').value.trim(),
            port: parseInt(document.getElementById('email-smtp-port').value) || 587,
            secure: document.getElementById('email-smtp-secure').value === 'true',
            user: document.getElementById('email-smtp-user').value.trim(),
            pass: document.getElementById('email-smtp-pass').value.trim()
          },
          from: document.getElementById('email-from').value.trim(),
          to: document.getElementById('email-to').value.trim()
        };

        if (!emailSettings.smtp.host || !emailSettings.from || !emailSettings.to) {
          showNotification('Error: SMTP host, from email, and to email are required for testing', 'error');
          return;
        }

        if (!emailSettings.smtp.user || !emailSettings.smtp.pass) {
          showNotification('Error: SMTP username and password are required for testing', 'error');
          return;
        }

        testEmailBtn.disabled = true;
        testEmailBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Testing...';

        try {
          const response = await fetch('/api/settings/email/test', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(emailSettings)
          });

          if (!response.ok) {
            throw new Error('Failed to test Email connection');
          }

          const data = await response.json();
          if (data.success) {
            showNotification(' Email test message sent successfully!', 'success');
          } else {
            showNotification(' Email test failed: ' + data.message, 'error');
          }
        } catch (err) {
          console.error('Error:', err);
          showNotification(' Failed to test Email connection', 'error');
        } finally {
          testEmailBtn.disabled = false;
          testEmailBtn.innerHTML = '<i class="fas fa-paper-plane mr-2"></i>Test Email';
        }
      });
    }

    // Save Flapping settings
    if (saveFlappingBtn) {
      saveFlappingBtn.addEventListener('click', async function() {
        const flappingSettings = {
          enabled: document.getElementById('flapping-enabled').checked,
          deviceThreshold: parseInt(document.getElementById('flapping-device-threshold').value),
          deviceWindowMinutes: parseInt(document.getElementById('flapping-device-window').value),
          pingThreshold: parseInt(document.getElementById('flapping-ping-threshold').value),
          pingWindowMinutes: parseInt(document.getElementById('flapping-ping-window').value),
          suppressNotifications: document.getElementById('flapping-suppress-notifications').checked,
          notifyOnFlappingStart: document.getElementById('flapping-notify-start').checked,
          notifyOnFlappingStop: document.getElementById('flapping-notify-stop').checked
        };

        // Validation
        if (flappingSettings.deviceThreshold < 2 || flappingSettings.deviceThreshold > 20) {
          showNotification('Error: Device threshold must be between 2 and 20', 'error');
          return;
        }
        if (flappingSettings.deviceWindowMinutes < 1 || flappingSettings.deviceWindowMinutes > 60) {
          showNotification('Error: Device window must be between 1 and 60 minutes', 'error');
          return;
        }
        if (flappingSettings.pingThreshold < 2 || flappingSettings.pingThreshold > 20) {
          showNotification('Error: Ping threshold must be between 2 and 20', 'error');
          return;
        }
        if (flappingSettings.pingWindowMinutes < 1 || flappingSettings.pingWindowMinutes > 60) {
          showNotification('Error: Ping window must be between 1 and 60 minutes', 'error');
          return;
        }

        saveFlappingBtn.disabled = true;
        saveFlappingBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Saving...';

        try {
          const response = await fetch('/api/settings/flapping', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(flappingSettings)
          });

          if (!response.ok) {
            throw new Error('Failed to update Flapping settings');
          }

          const data = await response.json();
          showNotification(' Flapping settings saved successfully', 'success');

          // Refresh settings after 2 seconds
          setTimeout(() => {
            location.reload();
          }, 2000);
        } catch (err) {
          console.error('Error:', err);
          showNotification(' Failed to save Flapping settings', 'error');
        } finally {
          saveFlappingBtn.disabled = false;
          saveFlappingBtn.innerHTML = '<i class="fas fa-save mr-2"></i>Save Settings';
        }
      });
    }

    // View Flapping Status
    if (viewFlappingStatusBtn) {
      viewFlappingStatusBtn.addEventListener('click', async function() {
        viewFlappingStatusBtn.disabled = true;
        viewFlappingStatusBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Loading...';

        try {
          const response = await fetch('/api/flapping/status');

          if (!response.ok) {
            throw new Error('Failed to get flapping status');
          }

          const data = await response.json();

          // Create status display
          let statusMessage = ' <b>Flapping Status</b>\n\n';

          // Device flapping
          statusMessage += '<b> Device Flapping:</b>\n';
          const deviceFlapping = Object.values(data.deviceFlapping);
          if (deviceFlapping.length === 0) {
            statusMessage += ' No devices currently flapping\n';
          } else {
            deviceFlapping.forEach(device => {
              const status = device.isFlapping ? ' FLAPPING' : ' Stable';
              statusMessage += ` ${device.deviceName}: ${status} (${device.transitionCount} transitions)\n`;
            });
          }

          // Ping flapping
          statusMessage += '\n<b> Ping Flapping:</b>\n';
          const pingFlapping = Object.values(data.pingFlapping);
          if (pingFlapping.length === 0) {
            statusMessage += ' No ping targets currently flapping\n';
          } else {
            pingFlapping.forEach(target => {
              const status = target.isFlapping ? ' FLAPPING' : ' Stable';
              statusMessage += ` ${target.targetName} (${target.targetHost}): ${status} (${target.transitionCount} transitions)\n`;
            });
          }

          // Active alerts
          const activeAlerts = Object.keys(data.activeAlerts).length;
          statusMessage += `\n<b> Active Alerts:</b> ${activeAlerts}\n`;

          // Show in notification (this will be a long message, but Telegram handles it)
          // For now, just show a summary
          const totalFlapping = deviceFlapping.filter(d => d.isFlapping).length + pingFlapping.filter(p => p.isFlapping).length;
          showNotification(`Flapping Status: ${totalFlapping} items flapping, ${activeAlerts} active alerts`, totalFlapping > 0 ? 'warning' : 'success');

        } catch (err) {
          console.error('Error:', err);
          showNotification(' Failed to get flapping status', 'error');
        } finally {
          viewFlappingStatusBtn.disabled = false;
          viewFlappingStatusBtn.innerHTML = '<i class="fas fa-eye mr-2"></i>View Status';
        }
      });
    }
  </script>
</body>
</html>
