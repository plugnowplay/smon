<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= title %></title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    /* Custom animations and styles */
    @keyframes pulse-green {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    .animate-pulse-green {
      animation: pulse-green 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }

    @keyframes pulse-blue {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    .animate-pulse-blue {
      animation: pulse-blue 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .animate-fade-in {
      animation: fadeIn 0.5s ease-out;
    }

    /* Smooth transitions */
    * {
      transition-property: color, background-color, border-color, text-decoration-color, fill, stroke, opacity, box-shadow, transform, filter, backdrop-filter;
      transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
      transition-duration: 300ms;
    }

    /* Progress bar styles */
    .progress-bar {
      background: linear-gradient(90deg, #10b981 0%, #059669 100%);
      border-radius: 4px;
      transition: width 0.3s ease;
    }

    .progress-bg {
      background: linear-gradient(90deg, #374151 0%, #4b5563 100%);
      border-radius: 4px;
    }
  </style>
</head>
<body class="bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 text-gray-100 min-h-screen">
  <div class="min-h-screen flex items-center justify-center p-4">
    <div class="max-w-6xl w-full space-y-8">
      <!-- Header -->
      <div class="text-center animate-fade-in">
        <div class="flex items-center justify-center gap-4 mb-4">
          <div class="w-16 h-16 bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl flex items-center justify-center shadow-2xl">
            <i class="fas fa-chart-line text-white text-2xl"></i>
          </div>
          <div>
            <h1 class="text-4xl font-bold text-white">SMon</h1>
            <p class="text-xl text-gray-400">Network Monitoring System</p>
          </div>
        </div>
        <p class="text-gray-400 text-lg">System Status Dashboard</p>
      </div>

      <!-- Status Cards Container -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="status-container">
        <!-- Loading placeholder -->
        <div class="bg-gradient-to-br from-slate-800 to-slate-900 rounded-2xl border border-slate-700/50 p-6 shadow-2xl animate-fade-in">
          <div class="flex items-center justify-center h-32">
            <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"></div>
          </div>
        </div>
        <div class="bg-gradient-to-br from-slate-800 to-slate-900 rounded-2xl border border-slate-700/50 p-6 shadow-2xl animate-fade-in">
          <div class="flex items-center justify-center h-32">
            <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-green-500"></div>
          </div>
        </div>
        <div class="bg-gradient-to-br from-slate-800 to-slate-900 rounded-2xl border border-slate-700/50 p-6 shadow-2xl animate-fade-in">
          <div class="flex items-center justify-center h-32">
            <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-purple-500"></div>
          </div>
        </div>
      </div>

      <!-- System Details -->
      <div class="bg-gradient-to-br from-slate-800 to-slate-900 rounded-2xl border border-slate-700/50 p-8 shadow-2xl animate-fade-in" id="system-details" style="display: none;">
        <h2 class="text-2xl font-bold text-white mb-6 flex items-center gap-3">
          <div class="w-8 h-8 bg-gradient-to-br from-orange-500 to-orange-600 rounded-lg flex items-center justify-center">
            <i class="fas fa-server text-white text-sm"></i>
          </div>
          System Details
        </h2>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6" id="system-info">
          <!-- Loading -->
          <div class="text-center py-8">
            <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-orange-500 mx-auto mb-2"></div>
            <p class="text-gray-400">Loading system information...</p>
          </div>
        </div>
      </div>

      <!-- Footer -->
      <div class="text-center text-gray-500 text-sm animate-fade-in">
        <p>Â© 2025 SMon - Network Monitoring System</p>
        <p class="mt-1">Last updated: <span id="last-updated">Loading...</span></p>
      </div>
    </div>
  </div>

  <script>
    // Status data
    let statusData = {
      snmp: { status: 'unknown', message: 'Checking...' },
      ping: { status: 'unknown', message: 'Checking...' },
      database: { status: 'unknown', message: 'Checking...' },
      telegram: { status: 'unknown', message: 'Checking...' }
    };

    // Update status cards
    function updateStatusCards() {
      const container = document.getElementById('status-container');

      const cards = [
        {
          title: 'SNMP Monitoring',
          icon: 'fas fa-network-wired',
          color: 'blue',
          key: 'snmp'
        },
        {
          title: 'Ping Monitoring',
          <a href="/websites" class="flex items-center gap-3 px-4 py-3 rounded-lg text-gray-300 hover:bg-slate-700 transition-all duration-200">
            <i class="fas fa-globe w-5"></i>
            <span>Website Monitor</span>
          </a>
          icon: 'fas fa-broadcast-tower',
          color: 'green',
          key: 'ping'
        },
        {
          title: 'Database',
          icon: 'fas fa-database',
          color: 'purple',
          key: 'database'
        },
        {
          title: 'Telegram Bot',
          icon: 'fab fa-telegram-plane',
          color: 'blue',
          key: 'telegram'
        },
        {
          title: 'Web Interface',
          icon: 'fas fa-globe',
          color: 'green',
          key: 'web'
        },
        {
          title: 'System Health',
          icon: 'fas fa-heartbeat',
          color: 'red',
          key: 'system'
        }
      ];

      container.innerHTML = cards.map(card => {
        const data = statusData[card.key] || { status: 'unknown', message: 'Checking...' };
        const statusColor = getStatusColor(data.status);
        const pulseClass = data.status === 'online' ? 'animate-pulse-green' : data.status === 'active' ? 'animate-pulse-blue' : '';

        return `
          <div class="bg-gradient-to-br from-slate-800 to-slate-900 rounded-2xl border border-slate-700/50 p-6 shadow-2xl hover:shadow-3xl transition-all duration-300 hover:scale-105 animate-fade-in">
            <div class="flex items-center justify-between mb-4">
              <div class="flex items-center gap-3">
                <div class="w-12 h-12 bg-gradient-to-br from-${card.color}-500 to-${card.color}-600 rounded-xl flex items-center justify-center shadow-lg ${pulseClass}">
                  <i class="${card.icon} text-white text-lg"></i>
                </div>
                <div>
                  <h3 class="text-lg font-semibold text-white">${card.title}</h3>
                  <p class="text-sm text-gray-400">${data.message}</p>
                </div>
              </div>
              <div class="w-4 h-4 bg-${statusColor}-500 rounded-full shadow-lg ${data.status === 'online' || data.status === 'active' ? 'animate-pulse' : ''}"></div>
            </div>
          </div>
        `;
      }).join('');
    }

    function getStatusColor(status) {
      switch(status) {
        case 'online':
        case 'active':
        case 'healthy':
          return 'green';
        case 'warning':
          return 'yellow';
        case 'error':
        case 'offline':
          return 'red';
        default:
          return 'gray';
      }
    }

    // Update system information
    async function updateSystemInfo() {
      try {
        const response = await fetch('/api/system-info');
        const data = await response.json();

        document.getElementById('system-details').style.display = 'block';

        const systemInfo = document.getElementById('system-info');
        systemInfo.innerHTML = `
          <div class="space-y-4">
            <div class="flex justify-between items-center p-3 bg-slate-700/30 rounded-lg">
              <span class="text-gray-300">Node.js Version</span>
              <span class="text-white font-medium">${data.nodeVersion}</span>
            </div>
            <div class="flex justify-between items-center p-3 bg-slate-700/30 rounded-lg">
              <span class="text-gray-300">Platform</span>
              <span class="text-white font-medium">${data.platform}</span>
            </div>
            <div class="flex justify-between items-center p-3 bg-slate-700/30 rounded-lg">
              <span class="text-gray-300">Uptime</span>
              <span class="text-white font-medium">${data.uptime}</span>
            </div>
            <div class="flex justify-between items-center p-3 bg-slate-700/30 rounded-lg">
              <span class="text-gray-300">CPU Cores</span>
              <span class="text-white font-medium">${data.cpuCores}</span>
            </div>
          </div>
          <div class="space-y-4">
            <div>
              <div class="flex justify-between items-center mb-2">
                <span class="text-gray-300">CPU Usage</span>
                <span class="text-white font-medium">${data.cpuUsage}%</span>
              </div>
              <div class="progress-bg w-full h-3">
                <div class="progress-bar h-3" style="width: ${Math.min(data.cpuUsage, 100)}%"></div>
              </div>
            </div>
            <div>
              <div class="flex justify-between items-center mb-2">
                <span class="text-gray-300">Memory Usage</span>
                <span class="text-white font-medium">${Math.round((data.memory.used / data.memory.total) * 100)}%</span>
              </div>
              <div class="progress-bg w-full h-3">
                <div class="progress-bar h-3" style="width: ${Math.min((data.memory.used / data.memory.total) * 100, 100)}%"></div>
              </div>
              <div class="text-xs text-gray-400 mt-1">
                ${Math.round(data.memory.used / 1024 / 1024 / 1024 * 10) / 10}GB / ${Math.round(data.memory.total / 1024 / 1024 / 1024 * 10) / 10}GB
              </div>
            </div>
            ${data.storage && data.storage.total > 0 ? `
            <div>
              <div class="flex justify-between items-center mb-2">
                <span class="text-gray-300">Storage Usage</span>
                <span class="text-white font-medium">${data.storage.percent}%</span>
              </div>
              <div class="progress-bg w-full h-3">
                <div class="progress-bar h-3" style="width: ${Math.min(data.storage.percent, 100)}%"></div>
              </div>
              <div class="text-xs text-gray-400 mt-1">
                ${Math.round(data.storage.used / 1024 / 1024 / 1024 * 10) / 10}GB / ${Math.round(data.storage.total / 1024 / 1024 / 1024 * 10) / 10}GB
              </div>
            </div>
            ` : ''}
          </div>
        `;
      } catch (error) {
        console.error('Error fetching system info:', error);
        document.getElementById('system-info').innerHTML = `
          <div class="text-center py-8 text-red-400">
            <i class="fas fa-exclamation-triangle text-2xl mb-2"></i>
            <p>Unable to load system information</p>
          </div>
        `;
      }
    }

    // Check service statuses
    async function checkStatuses() {
      try {
        // Check database connectivity
        const dbResponse = await fetch('/api/settings/influxdb/test', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({})
        }).catch(() => ({ ok: false }));

        statusData.database = dbResponse.ok ?
          { status: 'online', message: 'Connected' } :
          { status: 'offline', message: 'Connection failed' };

        // Check web interface
        statusData.web = { status: 'online', message: 'Running' };

        // Check system health
        const systemResponse = await fetch('/api/system-info');
        const systemData = await systemResponse.json();
        const cpuUsage = systemData.cpuUsage || 0;
        const memoryUsage = (systemData.memory.used / systemData.memory.total) * 100;

        if (cpuUsage > 90 || memoryUsage > 90) {
          statusData.system = { status: 'warning', message: 'High resource usage' };
        } else if (cpuUsage > 70 || memoryUsage > 80) {
          statusData.system = { status: 'warning', message: 'Moderate load' };
        } else {
          statusData.system = { status: 'healthy', message: 'Normal operation' };
        }

        // SNMP and Ping status (we'll assume they're active if the app is running)
        statusData.snmp = { status: 'active', message: 'Monitoring active' };
        statusData.ping = { status: 'active', message: 'Monitoring active' };

        // Telegram status (we can't easily check this without authentication)
        statusData.telegram = { status: 'unknown', message: 'Status unknown' };

      } catch (error) {
        console.error('Error checking statuses:', error);
      }

      updateStatusCards();
    }

    // Update timestamp
    function updateTimestamp() {
      const now = new Date();
      document.getElementById('last-updated').textContent = now.toLocaleString();
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
      updateStatusCards();
      updateSystemInfo();
      checkStatuses();
      updateTimestamp();

      // Update every 30 seconds
      setInterval(() => {
        updateSystemInfo();
        checkStatuses();
        updateTimestamp();
      }, 30000);
    });
  </script>
</body>
</html>